<!DOCTYPE html>













<html class="theme-next pisces" lang="zh-CN">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">


























<link rel="stylesheet" href="/myhexo/lib/font-awesome/css/font-awesome.min.css?v=4.6.2">

<link rel="stylesheet" href="/myhexo/css/main.css?v=6.7.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/myhexo/images/apple-touch-icon-next.png?v=6.7.0">


  <link rel="icon" type="image/png" sizes="32x32" href="/myhexo/images/favicon-32x32-next.png?v=6.7.0">


  <link rel="icon" type="image/png" sizes="16x16" href="/myhexo/images/favicon-16x16-next.png?v=6.7.0">


  <link rel="mask-icon" href="/myhexo/images/logo.svg?v=6.7.0" color="#222">







<script id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/myhexo/',
    scheme: 'Pisces',
    version: '6.7.0',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":false,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta property="og:type" content="website">
<meta property="og:title" content="小兵兵">
<meta property="og:url" content="https://shenlibing.github.io/myhexo/index.html">
<meta property="og:site_name" content="小兵兵">
<meta property="og:locale" content="zh-CN">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="小兵兵">






  <link rel="canonical" href="https://shenlibing.github.io/myhexo/">



<script id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>小兵兵</title>
  












  <noscript>
  <style>
  .use-motion .motion-element,
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-title { opacity: initial; }

  .use-motion .logo,
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope="" itemtype="http://schema.org/WebPage" lang="zh-CN">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

        <a href="https://github.com/shenlibing/" class="github-corner" aria-label="View source on GitHub"><svg width="80" height="80" viewbox="0 0 250 250" style="fill:#151513; color:#fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"/><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"/><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"/></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>

    <header id="header" class="header" itemscope="" itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta">
    

    <div class="custom-logo-site-title">
      <a href="/myhexo/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">小兵兵</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="切换导航栏">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home">

    
    
    
      
    

    

    <a href="/myhexo/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br>首页</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-about">

    
    
    
      
    

    

    <a href="/myhexo/about/" rel="section"><i class="menu-item-icon fa fa-fw fa-user"></i> <br>关于</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-tags">

    
    
    
      
    

    

    <a href="/myhexo/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i> <br>标签</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-categories">

    
    
    
      
    

    

    <a href="/myhexo/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i> <br>分类</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">

    
    
    
      
    

    

    <a href="/myhexo/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br>归档</a>

  </li>

      
      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br>搜索</a>
        </li>
      
    </ul>
  

  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off" placeholder="搜索..." spellcheck="false" type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
            

          
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://shenlibing.github.io/myhexo/myhexo/2019/01/26/技术分享/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="shenlibing">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/myhexo/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="小兵兵">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/myhexo/2019/01/26/技术分享/" class="post-title-link" itemprop="url">技术分享</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2019-01-26 09:27:20 / 修改时间：09:47:02" itemprop="dateCreated datePublished" datetime="2019-01-26T09:27:20+08:00">2019-01-26</time>
            

            
              

              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/myhexo/categories/日常记录/" itemprop="url" rel="index"><span itemprop="name">日常记录</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          
            <span id="/myhexo/2019/01/26/技术分享/" class="leancloud_visitors" data-flag-title="技术分享">
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              
                <span class="post-meta-item-text">阅读次数：</span>
              
                <span class="leancloud-visitors-count"></span>
            </span>
          

          

          
            <div class="post-symbolscount">
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">本文字数：</span>
                
                <span title="本文字数">500</span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">1 分钟</span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>1、快速深入地学习一个新技术、知识点步骤</p>
<p>1）我们有一个需求</p>
<ul>
<li>项目开发时，我们需要解决某个问题—页面局部刷新问题</li>
<li>跳槽，学习新技术</li>
</ul>
<p>2）先看看使用现有的技术能否解决这个问题</p>
<ul>
<li>可以解决，使用传统的方法iframe</li>
<li>发现使用传统的方法可以解决，但是不够好，使用新技术ajax</li>
</ul>
<p>3）学习新技术或者知识点</p>
<ul>
<li>原理</li>
<li>基本语法</li>
</ul>
<p>4）快速入门案例</p>
<ul>
<li>特点是简单</li>
<li>了解新技术或者知识点的基本使用，这里不需要涉及技术细节</li>
</ul>
<p>5）讨论这个新技术或者知识点的细节</p>
<ul>
<li>怎么使用更规范</li>
<li>使用该技术有没有什么陷阱</li>
<li>需要使用时，注意些什么</li>
</ul>
<p>2、学习方法的介绍</p>
<p>1）高效而愉快地学习</p>
<p>2）先建立一个<strong>整体框架</strong>，然后<strong>细节</strong></p>
<p>3）在实际工作中，要培养用到什么，能够快速学习什么的能力</p>
<p>4）先know how，再know why</p>
<p>5）软件编程是一门’<strong>做中学</strong>‘的学科，不是会了再做，而是做了才会</p>
<p>6）适当的<strong>囫囵吞枣</strong></p>
<p>7）学习软件编程是在在琢磨别人怎么做，而不是我认为应该怎么做的过程</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">for i:=0;i&lt;10;i++ &#123;</span><br><span class="line">	fmt.Println(&quot;hello,world&quot;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://shenlibing.github.io/myhexo/myhexo/2019/01/25/es6异步/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="shenlibing">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/myhexo/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="小兵兵">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/myhexo/2019/01/25/es6异步/" class="post-title-link" itemprop="url">es6异步</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2019-01-25 17:28:47" itemprop="dateCreated datePublished" datetime="2019-01-25T17:28:47+08:00">2019-01-25</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-01-26 17:00:13" itemprop="dateModified" datetime="2019-01-26T17:00:13+08:00">2019-01-26</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/myhexo/categories/日常记录/" itemprop="url" rel="index"><span itemprop="name">日常记录</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          
            <span id="/myhexo/2019/01/25/es6异步/" class="leancloud_visitors" data-flag-title="es6异步">
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              
                <span class="post-meta-item-text">阅读次数：</span>
              
                <span class="leancloud-visitors-count"></span>
            </span>
          

          

          
            <div class="post-symbolscount">
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">本文字数：</span>
                
                <span title="本文字数">8.8k</span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">8 分钟</span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>1、promise-解决异步操作</p>
<p>同步——串行    简单、方便</p>
<p>异步——并发    性能高、体验好</p>
<p>jQuery异步问题：回到地狱</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">$.ajax(&#123;</span><br><span class="line">  url: <span class="string">'/banner_data'</span>,</span><br><span class="line">  success(banners)&#123;</span><br><span class="line">    $.ajax(&#123;</span><br><span class="line">      url: <span class="string">'/user_data'</span>,</span><br><span class="line">      success(user)&#123;</span><br><span class="line">        $.ajax(&#123;</span><br><span class="line">          url: <span class="string">'/item_data'</span>,</span><br><span class="line">          success(items)&#123;</span><br><span class="line">            $.ajax(&#123;</span><br><span class="line">              url: <span class="string">'/news_data'</span>,</span><br><span class="line">              success(news)&#123;</span><br><span class="line"></span><br><span class="line">              &#125;,</span><br><span class="line">              error()&#123;</span><br><span class="line">                alert(<span class="string">'数据获取失败'</span>);</span><br><span class="line">              &#125;</span><br><span class="line">            &#125;)</span><br><span class="line">          &#125;,</span><br><span class="line">          error()&#123;</span><br><span class="line">            alert(<span class="string">'数据获取失败'</span>);</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;,</span><br><span class="line">      error()&#123;</span><br><span class="line">        alert(<span class="string">'数据获取失败'</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;,</span><br><span class="line">  error()&#123;</span><br><span class="line">    alert(<span class="string">'数据获取失败'</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>使用Promise</p>
<p>Promise.all()     与：所有的都成功</p>
<p>Promise.race()     或：只要有一个完成</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Promise</span></span><br><span class="line"><span class="built_in">Promise</span>.all([</span><br><span class="line">  $.ajax(<span class="string">'/banner_data'</span>),</span><br><span class="line">  $.ajax(<span class="string">'/item_data'</span>),</span><br><span class="line">  $.ajax(<span class="string">'/user_data'</span>),</span><br><span class="line">  $.ajax(<span class="string">'/news_data'</span>),</span><br><span class="line">]).then(<span class="function"><span class="params">arr</span>=&gt;</span>&#123;</span><br><span class="line">  <span class="keyword">let</span> [banners, items, user, news]=arr;</span><br><span class="line">&#125;, ()=&gt;&#123;&#125;)</span><br></pre></td></tr></table></figure>
<p>1.txt</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&quot;a&quot;: 3, &quot;b&quot;: 5&#125;</span><br></pre></td></tr></table></figure>
<p>2.txt</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[12,5,8,3]</span><br></pre></td></tr></table></figure>
<p>3.txt</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&quot;name&quot;: &quot;blue&quot;, &quot;age&quot;: 18&#125;</span><br></pre></td></tr></table></figure>
<p>promise怎么用.html</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span><span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"jquery.js"</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript">    <span class="keyword">let</span> p = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">      <span class="comment">//resolve       解决-&gt;成功</span></span></span><br><span class="line"><span class="javascript">      <span class="comment">//reject        拒绝-&gt;失败</span></span></span><br><span class="line"><span class="javascript">      $.ajax(&#123;</span></span><br><span class="line"><span class="javascript">        url: <span class="string">'1.txt'</span>,</span></span><br><span class="line"><span class="javascript">        dataType: <span class="string">'json'</span>,</span></span><br><span class="line"><span class="undefined">        success(json) &#123;</span></span><br><span class="line"><span class="undefined">          resolve(json)</span></span><br><span class="line"><span class="undefined">        &#125;,</span></span><br><span class="line"><span class="undefined">        error(err) &#123;</span></span><br><span class="line"><span class="undefined">          reject(err)</span></span><br><span class="line"><span class="undefined">        &#125;</span></span><br><span class="line"><span class="undefined">      &#125;)</span></span><br><span class="line"><span class="undefined">    &#125;)</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">    <span class="keyword">debugger</span></span></span><br><span class="line"><span class="javascript">    p.then(<span class="function"><span class="params">json</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">      alert(<span class="string">'成功'</span>)</span></span><br><span class="line"><span class="javascript">      <span class="built_in">console</span>.log(json)</span></span><br><span class="line"><span class="undefined">    &#125;, err =&gt; &#123;</span></span><br><span class="line"><span class="javascript">      alert(<span class="string">'失败'</span>)</span></span><br><span class="line"><span class="undefined">    &#125;)</span></span><br><span class="line"><span class="undefined">  </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>promise怎么用2.html</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span><span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"jquery.js"</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript">    <span class="keyword">let</span> p = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">      <span class="comment">//resolve       解决-&gt;成功</span></span></span><br><span class="line"><span class="javascript">      <span class="comment">//reject        拒绝-&gt;失败</span></span></span><br><span class="line"><span class="javascript">      $.ajax(&#123;</span></span><br><span class="line"><span class="javascript">        url: <span class="string">'1.txt'</span>,</span></span><br><span class="line"><span class="javascript">        dataType: <span class="string">'json'</span>,</span></span><br><span class="line"><span class="undefined">        success(json) &#123;</span></span><br><span class="line"><span class="undefined">          resolve(json)</span></span><br><span class="line"><span class="undefined">        &#125;,</span></span><br><span class="line"><span class="undefined">        error(err) &#123;</span></span><br><span class="line"><span class="undefined">          reject(err)</span></span><br><span class="line"><span class="undefined">        &#125;</span></span><br><span class="line"><span class="undefined">      &#125;)</span></span><br><span class="line"><span class="undefined">    &#125;)</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">    <span class="keyword">let</span> p2 = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">      <span class="comment">//resolve       解决-&gt;成功</span></span></span><br><span class="line"><span class="javascript">      <span class="comment">//reject        拒绝-&gt;失败</span></span></span><br><span class="line"><span class="javascript">      $.ajax(&#123;</span></span><br><span class="line"><span class="javascript">        url: <span class="string">'2.txt'</span>,</span></span><br><span class="line"><span class="javascript">        dataType: <span class="string">'json'</span>,</span></span><br><span class="line"><span class="undefined">        success(json) &#123;</span></span><br><span class="line"><span class="undefined">          resolve(json)</span></span><br><span class="line"><span class="undefined">        &#125;,</span></span><br><span class="line"><span class="undefined">        error(err) &#123;</span></span><br><span class="line"><span class="undefined">          reject(err)</span></span><br><span class="line"><span class="undefined">        &#125;</span></span><br><span class="line"><span class="undefined">      &#125;);</span></span><br><span class="line"><span class="undefined">    &#125;);</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">    <span class="keyword">let</span> p3 = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">      <span class="comment">//resolve       解决-&gt;成功</span></span></span><br><span class="line"><span class="javascript">      <span class="comment">//reject        拒绝-&gt;失败</span></span></span><br><span class="line"><span class="javascript">      $.ajax(&#123;</span></span><br><span class="line"><span class="javascript">        url: <span class="string">'3.txt'</span>,</span></span><br><span class="line"><span class="javascript">        dataType: <span class="string">'json'</span>,</span></span><br><span class="line"><span class="undefined">        success(json) &#123;</span></span><br><span class="line"><span class="undefined">          resolve(json)</span></span><br><span class="line"><span class="undefined">        &#125;,</span></span><br><span class="line"><span class="undefined">        error(err) &#123;</span></span><br><span class="line"><span class="undefined">          reject(err)</span></span><br><span class="line"><span class="undefined">        &#125;</span></span><br><span class="line"><span class="undefined">      &#125;)</span></span><br><span class="line"><span class="undefined">    &#125;)</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">    <span class="built_in">Promise</span>.all([p, p2, p3]).then(<span class="function"><span class="params">arr</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">let</span> [j1, a, j2] = arr;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">      alert(<span class="string">'成功'</span>)</span></span><br><span class="line"><span class="javascript">      <span class="built_in">console</span>.log(j1, a, j2)</span></span><br><span class="line"><span class="undefined">    &#125;, err =&gt; &#123;</span></span><br><span class="line"><span class="javascript">      alert(<span class="string">'失败'</span>)</span></span><br><span class="line"><span class="undefined">    &#125;)</span></span><br><span class="line"><span class="undefined">  </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>promise怎么用3.html</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span><span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"jquery.js"</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript">    $.ajax(&#123;</span></span><br><span class="line"><span class="javascript">      url: <span class="string">'1.txt'</span>,</span></span><br><span class="line"><span class="javascript">      dataType: <span class="string">'json'</span></span></span><br><span class="line"><span class="javascript">    &#125;).then(<span class="function"><span class="params">json</span>=&gt;</span>&#123;</span></span><br><span class="line"><span class="javascript">      alert(<span class="string">'成了'</span>);</span></span><br><span class="line"><span class="undefined">    &#125;, err=&gt;&#123;</span></span><br><span class="line"><span class="javascript">      alert(<span class="string">'错了'</span>);</span></span><br><span class="line"><span class="undefined">    &#125;);</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">    <span class="keyword">debugger</span></span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="undefined">    /*</span></span><br><span class="line"><span class="javascript">    <span class="built_in">Promise</span>.all([p, p2, p3]).then(<span class="function"><span class="params">arr</span>=&gt;</span>&#123;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">let</span> [j1, a, j2]=arr;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">      alert(<span class="string">'成功'</span>);</span></span><br><span class="line"><span class="javascript">      <span class="built_in">console</span>.log(j1, a, j2);</span></span><br><span class="line"><span class="undefined">    &#125;, err=&gt;&#123;</span></span><br><span class="line"><span class="javascript">      alert(<span class="string">'失败'</span>);</span></span><br><span class="line"><span class="undefined">    &#125;);</span></span><br><span class="line"><span class="undefined">    */</span></span><br><span class="line"><span class="undefined">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>promise怎么用4.html</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span><span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"jquery.js"</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript">    <span class="built_in">Promise</span>.all([</span></span><br><span class="line"><span class="javascript">      $.ajax(&#123;<span class="attr">url</span>: <span class="string">'1.txt'</span>, <span class="attr">dataType</span>: <span class="string">'json'</span>&#125;),</span></span><br><span class="line"><span class="javascript">      $.ajax(&#123;<span class="attr">url</span>: <span class="string">'2.txt'</span>, <span class="attr">dataType</span>: <span class="string">'json'</span>&#125;),</span></span><br><span class="line"><span class="javascript">      $.ajax(&#123;<span class="attr">url</span>: <span class="string">'3.txt'</span>, <span class="attr">dataType</span>: <span class="string">'json'</span>&#125;),</span></span><br><span class="line"><span class="javascript">    ]).then(<span class="function"><span class="params">arr</span>=&gt;</span>&#123;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">let</span> [j1, a, j2]=arr;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">      <span class="built_in">console</span>.log(j1, a, j2);</span></span><br><span class="line"><span class="undefined">    &#125;, err=&gt;&#123;</span></span><br><span class="line"><span class="javascript">      alert(<span class="string">'失败'</span>);</span></span><br><span class="line"><span class="undefined">    &#125;);</span></span><br><span class="line"><span class="undefined">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>结论</p>
<ul>
<li>Proimse有用——解除异步操作</li>
<li>Promise有局限——带逻辑的异步操作麻烦</li>
</ul>
<p>2、generator-生成器（过渡）</p>
<p>可以暂停</p>
<p>generator函数.html</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span><span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript">    <span class="function"><span class="keyword">function</span>* <span class="title">show</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">      alert(<span class="string">'aaa'</span>)</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">      <span class="keyword">yield</span></span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">      alert(<span class="string">'bbb'</span>)</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">    <span class="keyword">let</span> gen = show()</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">    gen.next() <span class="comment">//aaa</span></span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">    setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">      gen.next() <span class="comment">//bbb</span></span></span><br><span class="line"><span class="undefined">    &#125;, 5000)</span></span><br><span class="line"><span class="undefined">  </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>generator函数3.html</p>
<p>传参</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span><span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript">    <span class="function"><span class="keyword">function</span> *<span class="title">show</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">      alert(<span class="string">'aaa'</span>);</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">      <span class="keyword">let</span> a=<span class="keyword">yield</span>;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">      alert(<span class="string">'bbb'</span>+a);</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">    <span class="keyword">let</span> gen=show();</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="undefined">    gen.next();</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="undefined">    gen.next(12);</span></span><br><span class="line"><span class="undefined">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>generator函数4.html</p>
<p>返回值</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span><span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript">    <span class="function"><span class="keyword">function</span>* <span class="title">show</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">      alert(<span class="string">'aaa'</span>)</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">      <span class="keyword">yield</span> <span class="number">55</span></span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">      alert(<span class="string">'bbb'</span>)</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">      <span class="keyword">return</span> <span class="number">89</span></span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">    <span class="keyword">let</span> gen = show()</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">    <span class="keyword">let</span> res1 = gen.next()</span></span><br><span class="line"><span class="javascript">    <span class="comment">// debugger</span></span></span><br><span class="line"><span class="javascript">    <span class="built_in">console</span>.log(res1) <span class="comment">//&#123;value: 55, done: false&#125;</span></span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">    <span class="keyword">let</span> res2 = gen.next()</span></span><br><span class="line"><span class="javascript">    <span class="built_in">console</span>.log(res2) <span class="comment">//&#123;value: 89, done: true&#125;</span></span></span><br><span class="line"><span class="undefined">  </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>3、async/await（推荐，es7）</p>
<p>可以暂停且可以处理带业务逻辑、异常</p>
<p>async和await.html</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span><span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript">    <span class="function"><span class="keyword">function</span> <span class="title">sleep</span>(<span class="params">sec</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">        setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="undefined">          resolve()</span></span><br><span class="line"><span class="undefined">        &#125;, sec * 1000)</span></span><br><span class="line"><span class="undefined">      &#125;)</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">    <span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">show</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">      alert(<span class="string">'a'</span>)</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">      <span class="keyword">await</span> sleep(<span class="number">1</span>)</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">      alert(<span class="string">'b'</span>)</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">      <span class="keyword">await</span> sleep(<span class="number">2</span>)</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">      alert(<span class="string">'c'</span>)</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="undefined">    show()</span></span><br><span class="line"><span class="undefined">  </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>处理带业务逻辑</p>
<p>async和await2.html</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span><span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"jquery.js"</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript">    (<span class="keyword">async</span> () =&gt; &#123;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">let</span> data1 = <span class="keyword">await</span> $.ajax(&#123;</span></span><br><span class="line"><span class="javascript">        url: <span class="string">'1.txt'</span>,</span></span><br><span class="line"><span class="javascript">        dataType: <span class="string">'json'</span></span></span><br><span class="line"><span class="undefined">      &#125;)</span></span><br><span class="line"><span class="javascript">      <span class="built_in">console</span>.log(<span class="string">'data1=========&gt;'</span>, data1)</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">      <span class="keyword">if</span> (data1.a + data1.b &lt; <span class="number">10</span>) &#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">let</span> data2 = <span class="keyword">await</span> $.ajax(&#123;</span></span><br><span class="line"><span class="javascript">          url: <span class="string">'2.txt'</span>,</span></span><br><span class="line"><span class="javascript">          dataType: <span class="string">'json'</span></span></span><br><span class="line"><span class="undefined">        &#125;)</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="undefined">        alert(data2[0])</span></span><br><span class="line"><span class="javascript">      &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">let</span> data3 = <span class="keyword">await</span> $.ajax(&#123;</span></span><br><span class="line"><span class="javascript">          url: <span class="string">'3.txt'</span>,</span></span><br><span class="line"><span class="javascript">          dataType: <span class="string">'json'</span></span></span><br><span class="line"><span class="undefined">        &#125;)</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="undefined">        alert(data3.name)</span></span><br><span class="line"><span class="undefined">      &#125;</span></span><br><span class="line"><span class="undefined">    &#125;)()</span></span><br><span class="line"><span class="undefined">  </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>处理异常</p>
<p>async和await3.html</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span><span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"jquery.js"</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript">    <span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">show</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">try</span> &#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">let</span> data1 = <span class="keyword">await</span> $.ajax(&#123;</span></span><br><span class="line"><span class="javascript">          url: <span class="string">'1.txt'</span>,</span></span><br><span class="line"><span class="javascript">          dataType: <span class="string">'json'</span></span></span><br><span class="line"><span class="undefined">        &#125;)</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">        <span class="keyword">let</span> data2 = <span class="keyword">await</span> $.ajax(&#123;</span></span><br><span class="line"><span class="javascript">          url: <span class="string">'33.txt'</span>,</span></span><br><span class="line"><span class="javascript">          dataType: <span class="string">'json'</span></span></span><br><span class="line"><span class="undefined">        &#125;)</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">        <span class="keyword">let</span> data3 = <span class="keyword">await</span> $.ajax(&#123;</span></span><br><span class="line"><span class="javascript">          url: <span class="string">'3.txt'</span>,</span></span><br><span class="line"><span class="javascript">          dataType: <span class="string">'json'</span></span></span><br><span class="line"><span class="undefined">        &#125;)</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">        <span class="built_in">console</span>.log(data1, data2, data3)</span></span><br><span class="line"><span class="javascript">      &#125; <span class="keyword">catch</span> (e) &#123;</span></span><br><span class="line"><span class="javascript">        alert(<span class="string">'有问题'</span>)</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'我错了....'</span>)</span></span><br><span class="line"><span class="undefined">      &#125;</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="undefined">    show()</span></span><br><span class="line"><span class="undefined">  </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://shenlibing.github.io/myhexo/myhexo/2019/01/23/hexo博客搭建/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="shenlibing">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/myhexo/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="小兵兵">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/myhexo/2019/01/23/hexo博客搭建/" class="post-title-link" itemprop="url">hexo博客搭建</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2019-01-23 09:07:30" itemprop="dateCreated datePublished" datetime="2019-01-23T09:07:30+08:00">2019-01-23</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-01-27 12:35:03" itemprop="dateModified" datetime="2019-01-27T12:35:03+08:00">2019-01-27</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/myhexo/categories/日常记录/" itemprop="url" rel="index"><span itemprop="name">日常记录</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          
            <span id="/myhexo/2019/01/23/hexo博客搭建/" class="leancloud_visitors" data-flag-title="hexo博客搭建">
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              
                <span class="post-meta-item-text">阅读次数：</span>
              
                <span class="leancloud-visitors-count"></span>
            </span>
          

          

          
            <div class="post-symbolscount">
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">本文字数：</span>
                
                <span title="本文字数">8.1k</span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">7 分钟</span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>1、安装Node.js</p>
<p><a href="https://nodejs.org/en/" target="_blank" rel="noopener">https://nodejs.org/en/</a></p>
<p>2、安装Git</p>
<p><a href="https://git-scm.com/" target="_blank" rel="noopener">https://git-scm.com/</a></p>
<p>3、安装Hexo</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">//全局安装</span><br><span class="line">$ npm install -g hexo-cli</span><br></pre></td></tr></table></figure>
<p>存放位置</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">C:\Users\libingshen\AppData\Roaming\npm\node_modules</span><br></pre></td></tr></table></figure>
<p>验证安装是否成功</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">C:\Users\libingshen&gt;node --version</span><br><span class="line">v10.15.0</span><br><span class="line"></span><br><span class="line">C:\Users\libingshen&gt;npm --version</span><br><span class="line">6.4.1</span><br><span class="line"></span><br><span class="line">C:\Users\libingshen&gt;git --version</span><br><span class="line">git version 2.16.2.windows.1</span><br><span class="line"></span><br><span class="line">C:\Users\libingshen&gt;hexo --version</span><br><span class="line">hexo-cli: 1.1.0</span><br><span class="line">os: Windows_NT 10.0.17134 win32 x64</span><br><span class="line">http_parser: 2.8.0</span><br><span class="line">node: 10.15.0</span><br><span class="line">v8: 6.8.275.32-node.45</span><br><span class="line">uv: 1.23.2</span><br><span class="line">zlib: 1.2.11</span><br><span class="line">ares: 1.15.0</span><br><span class="line">modules: 64</span><br><span class="line">nghttp2: 1.34.0</span><br><span class="line">napi: 3</span><br><span class="line">openssl: 1.1.0j</span><br><span class="line">icu: 62.1</span><br><span class="line">unicode: 11.0</span><br><span class="line">cldr: 33.1</span><br><span class="line">tz: 2018e</span><br></pre></td></tr></table></figure>
<p>4、Hexo博客初始化</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ cd D:\mytest\myhexo</span><br><span class="line">$ hexo init</span><br><span class="line"></span><br><span class="line">//安装依赖</span><br><span class="line">$ npm install</span><br><span class="line"></span><br><span class="line">//或者hexo generate生成静态页</span><br><span class="line">$ hexo g </span><br><span class="line"></span><br><span class="line">//或者hexo server，启动服务器，可以在http://localhost:4000/ 查看</span><br><span class="line">$ hexo s</span><br></pre></td></tr></table></figure>
<p>5、Hexo博客部署到GitHub</p>
<p>1）本地客户端与GitHub建立授权连接生成公私钥</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh-keygen -t rsa -C &quot;782125244@qq.com&quot;</span><br></pre></td></tr></table></figure>
<p>公私钥存放位置</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">C:\Users\libingshen\.ssh</span><br></pre></td></tr></table></figure>
<p>将公钥内容上传到GitHub</p>
<p><img src="https://i.imgur.com/o3BsfxD.png" alt=""></p>
<p>2)GitHub创建仓库作为hexo博客的站点</p>
<p>3）hexo配置GitHub连接</p>
<p>安装 hexo-deployer-git</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm install hexo-deployer-git --save</span><br></pre></td></tr></table></figure>
<p>修改配置D:\mytest\myhexo_config.yml</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">#配置GitHub博客站址访问路径</span><br><span class="line"># URL这里要是没有配置，GitHub样式显示不出来</span><br><span class="line">## If your site is put in a subdirectory, set url as &apos;http://yoursite.com/child&apos; and root as &apos;/child/&apos;</span><br><span class="line">url: https://shenlibing.github.io/myhexo/</span><br><span class="line">root: /myhexo</span><br><span class="line">permalink: :year/:month/:day/:title/</span><br><span class="line">permalink_defaults:</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#博客推送到GitHub地址配置</span><br><span class="line"># Deployment</span><br><span class="line">## Docs: https://hexo.io/docs/deployment.html</span><br><span class="line">deploy:</span><br><span class="line">  type: git</span><br><span class="line">  repo: https://github.com/shenlibing/myhexo.git</span><br><span class="line">  branch: [master]</span><br></pre></td></tr></table></figure>
<p>4)配置GitHub Pages</p>
<p><img src="https://i.imgur.com/qSFHbX3.png" alt=""></p>
<p>6、备份博客源文件</p>
<p>hexo部署到GitHub只上传.deploy_git文件夹的内容，并不会上传_posts文件夹下的博客源文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">D:\mytest\myhexo\.deploy_git</span><br><span class="line"></span><br><span class="line">D:\mytest\myhexo\source\_posts</span><br></pre></td></tr></table></figure>
<p>解决：</p>
<p>将_posts文件夹作为git仓库，上传到GitHub，使得其作为另一个分支</p>
<p>创建并切换到新分支</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">libingshen@DESKTOP-7V287SK MINGW64 /d/mytest/myhexo/source/_posts (master)</span><br><span class="line">$ git checkout -b src</span><br><span class="line">Switched to a new branch &apos;src&apos;</span><br></pre></td></tr></table></figure>
<p>将新分支推送到GitHub</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git add .</span><br><span class="line">git commit -m &apos;add_v1:-新增hello-world笔记初始化&apos;</span><br><span class="line">git push origin src</span><br></pre></td></tr></table></figure>
<p>将博客源文件分支设为推送的默认分支，git push推送直接推送到src分支</p>
<p><img src="https://i.imgur.com/4glUdGW.png" alt=""></p>
<p>补充：</p>
<p>删除本地分支</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git branch -d src</span><br></pre></td></tr></table></figure>
<p>删除远程分支</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git push origin -d src</span><br></pre></td></tr></table></figure>
<p>切换分支</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git checkout master</span><br></pre></td></tr></table></figure>
<p>查看提交日志</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git log --oneline</span><br></pre></td></tr></table></figure>
<p>7、拓展</p>
<p>1)更换hexo主题</p>
<p>下载</p>
<p><a href="https://github.com/theme-next/hexo-theme-next" target="_blank" rel="noopener">https://github.com/theme-next/hexo-theme-next</a></p>
<p>解压放到D:\mytest\myhexo\themes</p>
<p><img src="https://i.imgur.com/hfH4rEM.png" alt=""></p>
<p>修改D:\mytest\myhexo_config.yml配置文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># Extensions</span><br><span class="line">## Plugins: https://hexo.io/plugins/</span><br><span class="line">## Themes: https://hexo.io/themes/</span><br><span class="line">theme: hexo-theme-next-master</span><br></pre></td></tr></table></figure>
<p>2）修改站点语言</p>
<p>编辑D:\mytest\myhexo_config.yml</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># Site</span><br><span class="line">title: 小兵兵</span><br><span class="line">subtitle:</span><br><span class="line">description:</span><br><span class="line">keywords:</span><br><span class="line">author: shenlibing</span><br><span class="line">language: zh-CN</span><br><span class="line">timezone:</span><br></pre></td></tr></table></figure>
<p>3）开启搜索、字数统计和阅读时长统计</p>
<p>安装依赖hexo-symbols-count-time、hexo-generator-searchdb，安装依赖不成功时先删除D:\mytest\myhexo\node_modules文件夹，重新安装依赖</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">npm install hexo-symbols-count-time --save</span><br><span class="line"></span><br><span class="line">npm install hexo-generator-searchdb --save</span><br></pre></td></tr></table></figure>
<p>配置主题样式文件</p>
<p>D:\mytest\myhexo\themes\hexo-theme-next-master_config.yml</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"># Local search</span><br><span class="line"># Dependencies: https://github.com/theme-next/hexo-generator-searchdb</span><br><span class="line">local_search:</span><br><span class="line">  enable: true</span><br><span class="line"></span><br><span class="line"># Dependencies: https://github.com/theme-next/hexo-symbols-count-time</span><br><span class="line">symbols_count_time:</span><br><span class="line">  separated_meta: true</span><br><span class="line">  item_text_post: true</span><br><span class="line">  item_text_total: false</span><br><span class="line">  awl: 4</span><br><span class="line">  wpm: 275</span><br></pre></td></tr></table></figure>
<p>配置站点文件</p>
<p>D:\mytest\myhexo_config.yml</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">#阅读时长和本文字数</span><br><span class="line">symbols_count_time:</span><br><span class="line">  symbols: true</span><br><span class="line">  time: true</span><br><span class="line">  total_symbols: true</span><br><span class="line">  total_time: true</span><br><span class="line"></span><br><span class="line">#搜索功能</span><br><span class="line">search:</span><br><span class="line">  path: search.xml</span><br><span class="line">  field: post</span><br><span class="line">  format: html</span><br><span class="line">  limit: 10000</span><br></pre></td></tr></table></figure>
<p>4）添加分类和标签</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new page categories</span><br><span class="line"></span><br><span class="line">$ hexo new page tags</span><br></pre></td></tr></table></figure>
<p>编辑D:\mytest\myhexo\source\categories\index.md</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">---</span><br><span class="line">title: categories</span><br><span class="line">date: 2019-01-22 16:37:58</span><br><span class="line">type: &quot;categories&quot;   #这部分是新添加的</span><br><span class="line">---</span><br></pre></td></tr></table></figure>
<p>编辑D:\mytest\myhexo\source\tags\index.md</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">---</span><br><span class="line">title: tags</span><br><span class="line">date: 2019-01-22 16:38:40</span><br><span class="line">type: &quot;tags&quot; #新添加的内容</span><br><span class="line">---</span><br></pre></td></tr></table></figure>
<p>修改菜单，添加categories和tags到menu中</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">menu:</span><br><span class="line">  home: / || home</span><br><span class="line">  #about: /about/ || user</span><br><span class="line">  tags: /tags/ || tags</span><br><span class="line">  categories: /categories/ || th</span><br><span class="line">  archives: /archives/ || archive</span><br><span class="line">  #schedule: /schedule/ || calendar</span><br><span class="line">  #sitemap: /sitemap.xml || sitemap</span><br><span class="line">  #commonweal: /404/ || heartbeat</span><br></pre></td></tr></table></figure>
<p>新增文章，添加categories、tags</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">---</span><br><span class="line">title: hexo博客搭建</span><br><span class="line">date: 2019-01-23 09:07:30</span><br><span class="line">categories: 日常记录</span><br><span class="line">tags: </span><br><span class="line">  - hexo</span><br><span class="line">  - git</span><br><span class="line">  - github</span><br><span class="line">  - node</span><br><span class="line">  - markdown</span><br><span class="line">---</span><br></pre></td></tr></table></figure>
<p>5）更换页面菜单布局位置</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># Schemes</span><br><span class="line">#scheme: Muse</span><br><span class="line">#scheme: Mist</span><br><span class="line">scheme: Pisces</span><br><span class="line">#scheme: Gemini</span><br></pre></td></tr></table></figure>
<p>6）配置文章浏览量</p>
<p>注册</p>
<p><a href="https://leancloud.cn/" target="_blank" rel="noopener">https://leancloud.cn/</a></p>
<p>创建应用</p>
<p><img src="https://i.imgur.com/NHal0S7.png" alt=""></p>
<p>创建Class</p>
<p><img src="https://i.imgur.com/eXGym94.png" alt=""></p>
<p>配置web安全域名</p>
<p><img src="https://i.imgur.com/FEbZt23.png" alt=""></p>
<p>获取app_id、app_key</p>
<p><img src="https://i.imgur.com/SE6pqQj.png" alt=""></p>
<p>编辑D:\mytest\myhexo\themes\hexo-theme-next-master_config.yml配置文件，填app_id、</p>
<p>app_key;security设置为false</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"># Show number of visitors to each article.</span><br><span class="line"># You can visit https://leancloud.cn get AppID and AppKey.</span><br><span class="line">leancloud_visitors:</span><br><span class="line">  enable: true</span><br><span class="line">  app_id: BedsOkBLOBR4nM4W52xTcBhb-gzGzoHsz #&lt;app_id&gt;</span><br><span class="line">  app_key: EEaRfb6dCMaS38laDCkSYhM9 #&lt;app_key&gt;</span><br><span class="line">  # Dependencies: https://github.com/theme-next/hexo-leancloud-counter-security</span><br><span class="line">  # If you don&apos;t care about security in leancloud counter and just want to use it directly</span><br><span class="line">  # (without hexo-leancloud-counter-security plugin), set `security` to `false`.</span><br><span class="line">  security: false</span><br><span class="line">  betterPerformance: false</span><br></pre></td></tr></table></figure>
<p>7）插入本地图片</p>
<p>安装依赖</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install hexo-asset-image --save</span><br></pre></td></tr></table></figure>
<p>编辑D:\mytest\myhexo_config.yml配置文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">post_asset_folder: true</span><br></pre></td></tr></table></figure>
<p>命令hexo new post test来生成博文时，/source/_post文件夹中除了test.md外，还有一个同名test文件夹</p>
<p>8)设置动态背景</p>
<p>进入D:\mytest\myhexo\themes\hexo-theme-next-master\layout\文件夹，编辑_layout.swig文件，在<code>&lt;/body&gt;</code>之前添加</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script type=&quot;text/javascript&quot; src=&quot;//cdn.bootcss.com/canvas-nest.js/1.0.0/canvas-nest.min.js&quot;&gt;&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<p>9)添加Fork me on GitHub</p>
<p>进入D:\mytest\myhexo\themes\hexo-theme-next-master\layout\文件夹，编辑_layout.swig文件，在<br><code>&lt;div class=&quot;headband&quot;&gt;&lt;/div&gt;</code>下面添加选择的<a href="http://tholman.com/github-corners/" target="_blank" rel="noopener">图标样式代码</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;a href=&quot;https://github.com/shenlibing/&quot; class=&quot;github-corner&quot; aria-label=&quot;View source on GitHub&quot;&gt;&lt;svg width=&quot;80&quot; height=&quot;80&quot; viewBox=&quot;0 0 250 250&quot; style=&quot;fill:#151513; color:#fff; position: absolute; top: 0; border: 0; right: 0;&quot; aria-hidden=&quot;true&quot;&gt;&lt;path d=&quot;M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z&quot;&gt;&lt;/path&gt;&lt;path d=&quot;M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2&quot; fill=&quot;currentColor&quot; style=&quot;transform-origin: 130px 106px;&quot; class=&quot;octo-arm&quot;&gt;&lt;/path&gt;&lt;path d=&quot;M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z&quot; fill=&quot;currentColor&quot; class=&quot;octo-body&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;&lt;style&gt;.github-corner:hover .octo-arm&#123;animation:octocat-wave 560ms ease-in-out&#125;@keyframes octocat-wave&#123;0%,100%&#123;transform:rotate(0)&#125;20%,60%&#123;transform:rotate(-25deg)&#125;40%,80%&#123;transform:rotate(10deg)&#125;&#125;@media (max-width:500px)&#123;.github-corner:hover .octo-arm&#123;animation:none&#125;.github-corner .octo-arm&#123;animation:octocat-wave 560ms ease-in-out&#125;&#125;&lt;/style&gt;</span><br></pre></td></tr></table></figure>
<p>10）添加友情链接</p>
<p>进入<code>D:\mytest\myhexo\themes\hexo-theme-next-master\layout\_partials</code>文件夹，在<code>footer.swig</code>文件末尾追加</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;div&gt;友情链接：</span><br><span class="line"> &lt;a class=&quot;theme-link&quot;  href=&quot;http://collect.w3ctrain.com/&quot;&gt; 前端收藏夹 &lt;/a&gt;&lt;span&gt;&amp;nbsp;&amp;nbsp;&lt;/span&gt;</span><br><span class="line"> &lt;a class=&quot;theme-link&quot; href=&quot;http://www.alloyteam.com/nav/&quot;&gt; Web前端导航 &lt;/a&gt;&lt;span&gt;&amp;nbsp;&amp;nbsp;&lt;/span&gt;</span><br><span class="line"> &lt;a class=&quot;theme-link&quot;  href=&quot;http://www.runoob.com/&quot;&gt; 菜鸟教程 &lt;/a&gt;&lt;span&gt;&amp;nbsp;&amp;nbsp;&lt;/span&gt;</span><br><span class="line"> &lt;a class=&quot;theme-link&quot; href=&quot;https://mccxj.github.io/&quot;&gt; 小毛的胡思乱想 &lt;/a&gt;&lt;span&gt;&amp;nbsp;&amp;nbsp;&lt;/span&gt;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure>
<p>参考：</p>
<p><a href="https://www.lixint.me/hexo-blog.html" target="_blank" rel="noopener">【持续更新】Github Pages + Hexo 博客搭建，Next主题个性化修改</a></p>
<p><a href="https://juejin.im/post/5bcd2d395188255c3b7dc1db" target="_blank" rel="noopener">Hexo+NexT 打造一个炫酷博客</a></p>
<p><a href="https://blog.csdn.net/sinat_37781304/article/details/82729029" target="_blank" rel="noopener">hexo史上最全搭建教程</a></p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://shenlibing.github.io/myhexo/myhexo/2019/01/15/优化点击事件绑定/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="shenlibing">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/myhexo/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="小兵兵">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/myhexo/2019/01/15/优化点击事件绑定/" class="post-title-link" itemprop="url">优化点击事件绑定</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2019-01-15 12:58:55" itemprop="dateCreated datePublished" datetime="2019-01-15T12:58:55+08:00">2019-01-15</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-01-22 17:14:00" itemprop="dateModified" datetime="2019-01-22T17:14:00+08:00">2019-01-22</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/myhexo/categories/日常记录/" itemprop="url" rel="index"><span itemprop="name">日常记录</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          
            <span id="/myhexo/2019/01/15/优化点击事件绑定/" class="leancloud_visitors" data-flag-title="优化点击事件绑定">
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              
                <span class="post-meta-item-text">阅读次数：</span>
              
                <span class="leancloud-visitors-count"></span>
            </span>
          

          

          
            <div class="post-symbolscount">
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">本文字数：</span>
                
                <span title="本文字数">1.7k</span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">2 分钟</span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>1、优化点击事件绑定</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"https://cdn.bootcss.com/jquery/3.3.1/jquery.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">data-action</span>=<span class="string">"id1"</span>&gt;</span>新增按钮1<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">data-action</span>=<span class="string">"id2"</span>&gt;</span>删除按钮2<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">data-action</span>=<span class="string">"id3"</span>&gt;</span>按钮3<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">data-action</span>=<span class="string">"id4"</span>&gt;</span>按钮4<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> log = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="built_in">console</span>.log.apply(<span class="built_in">console</span>, <span class="built_in">arguments</span>)</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> actionList = &#123;</span></span><br><span class="line"><span class="javascript">        <span class="string">'id1'</span>: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">            alert(<span class="string">'id1=============&gt;'</span>)</span></span><br><span class="line"><span class="undefined">        &#125;,</span></span><br><span class="line"><span class="javascript">        <span class="string">'id2'</span>: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">            alert(<span class="string">'id2===============&gt;'</span>)</span></span><br><span class="line"><span class="undefined">        &#125;,</span></span><br><span class="line"><span class="javascript">        <span class="string">'id3'</span>: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">            alert(<span class="string">'id3===============&gt;'</span>)</span></span><br><span class="line"><span class="undefined">        &#125;,</span></span><br><span class="line"><span class="javascript">        <span class="string">'id4'</span>: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">            alert(<span class="string">'id4===============&gt;'</span>)</span></span><br><span class="line"><span class="undefined">        &#125;</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">    <span class="keyword">let</span> $body = $(<span class="string">'body'</span>)</span></span><br><span class="line"><span class="javascript">    $body.on(<span class="string">'click'</span>, <span class="string">'[data-action]'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="comment">//jQuery获取html标签自定义属性值或data值</span></span></span><br><span class="line"><span class="javascript">        <span class="keyword">let</span> action_name = $(<span class="keyword">this</span>).data(<span class="string">'action'</span>)</span></span><br><span class="line"><span class="javascript">        <span class="keyword">let</span> action = actionList[action_name]</span></span><br><span class="line"><span class="javascript">        <span class="comment">// log(action)</span></span></span><br><span class="line"><span class="javascript">        <span class="comment">// log($.isFunction(action))</span></span></span><br><span class="line"><span class="javascript">        <span class="keyword">if</span> ($.isFunction(action)) &#123;</span></span><br><span class="line"><span class="undefined">            action()</span></span><br><span class="line"><span class="undefined">        &#125;</span></span><br><span class="line"><span class="undefined">    &#125;)</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">    <span class="comment">//页面需要新增一个按钮，做扩展</span></span></span><br><span class="line"><span class="xml">    $body.append('<span class="tag">&lt;<span class="name">button</span> <span class="attr">data-action</span>=<span class="string">"id5"</span>&gt;</span>按钮5<span class="tag">&lt;/<span class="name">button</span>&gt;</span>')</span></span><br><span class="line"><span class="javascript">    $.extend(actionList, &#123;</span></span><br><span class="line"><span class="javascript">        <span class="string">'id5'</span>: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">            alert(<span class="string">'id5============&gt;'</span>)</span></span><br><span class="line"><span class="undefined">        &#125;</span></span><br><span class="line"><span class="undefined">    &#125;)</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>参考</p>
<p><a href="https://github.com/cssmagic/blog/issues/48" target="_blank" rel="noopener">https://github.com/cssmagic/blog/issues/48</a></p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://shenlibing.github.io/myhexo/myhexo/2019/01/14/用户分配角色_角色维护权限树/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="shenlibing">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/myhexo/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="小兵兵">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/myhexo/2019/01/14/用户分配角色_角色维护权限树/" class="post-title-link" itemprop="url">用户分配角色_角色维护权限树</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2019-01-14 12:58:55" itemprop="dateCreated datePublished" datetime="2019-01-14T12:58:55+08:00">2019-01-14</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-01-22 17:34:20" itemprop="dateModified" datetime="2019-01-22T17:34:20+08:00">2019-01-22</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/myhexo/categories/日常记录/" itemprop="url" rel="index"><span itemprop="name">日常记录</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          
            <span id="/myhexo/2019/01/14/用户分配角色_角色维护权限树/" class="leancloud_visitors" data-flag-title="用户分配角色_角色维护权限树">
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              
                <span class="post-meta-item-text">阅读次数：</span>
              
                <span class="leancloud-visitors-count"></span>
            </span>
          

          

          
            <div class="post-symbolscount">
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">本文字数：</span>
                
                <span title="本文字数">16k</span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">15 分钟</span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>1、用户分配角色</p>
<p>效果图：</p>
<p><img src="https://i.imgur.com/ra0b05w.png" alt=""></p>
<p><img src="https://i.imgur.com/L33T2Cu.png" alt=""></p>
<p>实现思路：</p>
<p>1）先静态实现页面</p>
<p>2）从数据库查询用户未分配角色和已分配角色，前端初始化该列表</p>
<p>3）添加、移除用户拥有的角色</p>
<p>前端：</p>
<p>1)左移、右移：append和appendTo的使用</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">$(&quot;.unroles :selected&quot;).appendTo(&quot;.roles_select&quot;)</span><br></pre></td></tr></table></figure>
<p>2）遍历选中的角色</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">//遍历选中的元素,拼接用户角色id</span><br><span class="line">$(&apos;.unroles :selected&apos;).each(function() &#123;</span><br><span class="line">	log(this)</span><br><span class="line">	rids += $(this).val() + &apos;,&apos;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>3)ajax发送异步请求（参数拼接：用户id,角色rids）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">uid = &apos;$&#123;param.uid&#125;&apos;</span><br><span class="line">url = &apos;$&#123;ctp&#125;/permission/user/assignrole?opt=remove&amp;uid=&apos;</span><br><span class="line">		+ uid + &apos;&amp;rids=&apos; + rids + &apos;&apos;</span><br><span class="line"></span><br><span class="line">//发送请求移除</span><br><span class="line">$.get(url, fnf)</span><br></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"panel panel-default"</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"panel-body"</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">form</span> <span class="attr">role</span>=<span class="string">"form"</span> <span class="attr">class</span>=<span class="string">"form-inline"</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"form-group"</span>&gt;</span></span><br><span class="line">					<span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">"exampleInputPassword1"</span>&gt;</span>未分配角色列表<span class="tag">&lt;/<span class="name">label</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span> <span class="tag">&lt;<span class="name">select</span></span></span><br><span class="line"><span class="tag">						<span class="attr">class</span>=<span class="string">"form-control unroles"</span> <span class="attr">multiple</span> <span class="attr">size</span>=<span class="string">"10"</span></span></span><br><span class="line"><span class="tag">						<span class="attr">style</span>=<span class="string">"width: 100px; overflow-y: auto;"</span>&gt;</span></span><br><span class="line">						<span class="tag">&lt;<span class="name">c:forEach</span> <span class="attr">items</span>=<span class="string">"$&#123;list_user_unrole&#125;"</span> <span class="attr">var</span>=<span class="string">"user_unrole"</span>&gt;</span></span><br><span class="line">							<span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">"$&#123;user_unrole.id&#125;"</span>&gt;</span>$&#123;user_unrole.name&#125;<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">						<span class="tag">&lt;/<span class="name">c:forEach</span>&gt;</span></span><br><span class="line">					<span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"form-group"</span>&gt;</span></span><br><span class="line">					<span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">						<span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"btn btn-default glyphicon glyphicon-chevron-right"</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">						<span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">						<span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"btn btn-default glyphicon glyphicon-chevron-left"</span></span></span><br><span class="line"><span class="tag">							<span class="attr">style</span>=<span class="string">"margin-top: 20px;"</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">					<span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"form-group"</span> <span class="attr">style</span>=<span class="string">"margin-left: 40px;"</span>&gt;</span></span><br><span class="line">					<span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">"exampleInputPassword1"</span>&gt;</span>已分配角色列表<span class="tag">&lt;/<span class="name">label</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span> <span class="tag">&lt;<span class="name">select</span></span></span><br><span class="line"><span class="tag">						<span class="attr">class</span>=<span class="string">"form-control roles_select"</span> <span class="attr">multiple</span> <span class="attr">size</span>=<span class="string">"10"</span></span></span><br><span class="line"><span class="tag">						<span class="attr">style</span>=<span class="string">"width: 100px; overflow-y: auto;"</span>&gt;</span></span><br><span class="line">						<span class="tag">&lt;<span class="name">c:forEach</span> <span class="attr">items</span>=<span class="string">"$&#123;list_user_role&#125;"</span> <span class="attr">var</span>=<span class="string">"user_role"</span>&gt;</span></span><br><span class="line">							<span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">"$&#123;user_role.id&#125;"</span>&gt;</span>$&#123;user_role.name&#125;<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">						<span class="tag">&lt;/<span class="name">c:forEach</span>&gt;</span></span><br><span class="line">					<span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript">	$(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">		$(<span class="string">".list-group-item"</span>).click(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">			<span class="keyword">if</span> ($(<span class="keyword">this</span>).find(<span class="string">"ul"</span>)) &#123;</span></span><br><span class="line"><span class="javascript">				$(<span class="keyword">this</span>).toggleClass(<span class="string">"tree-closed"</span>);</span></span><br><span class="line"><span class="javascript">				<span class="keyword">if</span> ($(<span class="keyword">this</span>).hasClass(<span class="string">"tree-closed"</span>)) &#123;</span></span><br><span class="line"><span class="javascript">					$(<span class="string">"ul"</span>, <span class="keyword">this</span>).hide(<span class="string">"fast"</span>);</span></span><br><span class="line"><span class="javascript">				&#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="javascript">					$(<span class="string">"ul"</span>, <span class="keyword">this</span>).show(<span class="string">"fast"</span>);</span></span><br><span class="line"><span class="undefined">				&#125;</span></span><br><span class="line"><span class="undefined">			&#125;</span></span><br><span class="line"><span class="undefined">		&#125;);</span></span><br><span class="line"><span class="undefined">	&#125;);</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">	<span class="comment">//页面加载完成执行</span></span></span><br><span class="line"><span class="javascript">	$(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="undefined">		addUserRoleEvent()</span></span><br><span class="line"><span class="undefined">		removeUserRoleEvent()</span></span><br><span class="line"><span class="undefined">	&#125;)</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">	<span class="comment">//用户添加角色事件</span></span></span><br><span class="line"><span class="javascript">	<span class="keyword">var</span> addUserRoleEvent = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">		$(<span class="string">'.glyphicon-chevron-right'</span>).click(</span></span><br><span class="line"><span class="javascript">				<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">					log(<span class="string">'向右移动=============&gt;'</span>)</span></span><br><span class="line"><span class="javascript">					<span class="keyword">var</span> uid = <span class="string">''</span></span></span><br><span class="line"><span class="javascript">					<span class="keyword">var</span> rids = <span class="string">''</span></span></span><br><span class="line"><span class="javascript">					<span class="comment">//遍历选中的元素,拼接用户角色id</span></span></span><br><span class="line"><span class="javascript">					$(<span class="string">'.unroles :selected'</span>).each(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">						log(<span class="keyword">this</span>)</span></span><br><span class="line"><span class="javascript">						rids += $(<span class="keyword">this</span>).val() + <span class="string">','</span></span></span><br><span class="line"><span class="undefined">					&#125;)</span></span><br><span class="line"><span class="undefined">					rids = rids.substring(0, rids.length - 1)</span></span><br><span class="line"><span class="javascript">					log(<span class="string">'用户角色ids==========&gt;'</span>, rids)</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">					uid = <span class="string">'$&#123;param.uid&#125;'</span></span></span><br><span class="line"><span class="javascript">					url = <span class="string">'$&#123;ctp&#125;/permission/user/assignrole?opt=add&amp;uid='</span></span></span><br><span class="line"><span class="javascript">							+ uid + <span class="string">'&amp;rids='</span> + rids + <span class="string">''</span></span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">					<span class="comment">//选中的得进行处理添加到用户角色表中</span></span></span><br><span class="line"><span class="javascript">					<span class="comment">//发送请求给当前用户添加这几个角色，必须带上权限id的拼串和userid</span></span></span><br><span class="line"><span class="javascript">					$.get(url, fns)</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="undefined">				&#125;)</span></span><br><span class="line"><span class="undefined">	&#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">	<span class="comment">//用户删除角色事件</span></span></span><br><span class="line"><span class="javascript">	<span class="keyword">var</span> removeUserRoleEvent = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">		$(<span class="string">'.glyphicon-chevron-left'</span>)</span></span><br><span class="line"><span class="undefined">				.click(</span></span><br><span class="line"><span class="javascript">						<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">							log(<span class="string">'向左移动=============&gt;'</span>)</span></span><br><span class="line"><span class="javascript">							<span class="keyword">var</span> rids = <span class="string">''</span></span></span><br><span class="line"><span class="javascript">							$(<span class="string">'.roles_select :selected'</span>).each(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">								rids += $(<span class="keyword">this</span>).val() + <span class="string">','</span></span></span><br><span class="line"><span class="undefined">							&#125;)</span></span><br><span class="line"><span class="undefined">							rids = rids.substring(0, rids.length - 1)</span></span><br><span class="line"><span class="javascript">							log(<span class="string">'用户角色ids==========&gt;'</span>, rids)</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">							uid = <span class="string">'$&#123;param.uid&#125;'</span></span></span><br><span class="line"><span class="javascript">							url = <span class="string">'$&#123;ctp&#125;/permission/user/assignrole?opt=remove&amp;uid='</span></span></span><br><span class="line"><span class="javascript">									+ uid + <span class="string">'&amp;rids='</span> + rids + <span class="string">''</span></span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">							<span class="comment">//发送请求移除</span></span></span><br><span class="line"><span class="javascript">							$.get(url, fnf)</span></span><br><span class="line"><span class="undefined">						&#125;)</span></span><br><span class="line"><span class="undefined">	&#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">	<span class="comment">//异步请求成功的回调函数</span></span></span><br><span class="line"><span class="javascript">	<span class="keyword">var</span> fns = <span class="function"><span class="keyword">function</span>(<span class="params">data</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">		log(<span class="string">'异步请求成功的回调函数===============&gt;'</span>)</span></span><br><span class="line"><span class="javascript">		log(<span class="string">'data===========&gt;'</span>, data)</span></span><br><span class="line"><span class="javascript">		<span class="comment">//$('.roles_select').append($('.unroles :selected'))</span></span></span><br><span class="line"><span class="javascript">		$(<span class="string">".unroles :selected"</span>).appendTo(<span class="string">".roles_select"</span>)</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="undefined">	&#125;</span></span><br><span class="line"><span class="javascript">	<span class="comment">//异步请求失败的回调函数</span></span></span><br><span class="line"><span class="javascript">	<span class="keyword">var</span> fnf = <span class="function"><span class="keyword">function</span>(<span class="params">data</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">		log(<span class="string">'异步请求失败的回调函数===============&gt;'</span>)</span></span><br><span class="line"><span class="javascript">		log(<span class="string">'data===========&gt;'</span>, data)</span></span><br><span class="line"><span class="javascript">		$(<span class="string">'.roles_select :selected'</span>).appendTo(<span class="string">'.unroles'</span>)</span></span><br><span class="line"><span class="undefined">	&#125;</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>控制层:</p>
<p>1)</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 添加移除用户角色</span></span><br><span class="line">  <span class="meta">@RequestMapping</span>(<span class="string">"/assignrole"</span>)</span><br><span class="line">  <span class="meta">@ResponseBody</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> String <span class="title">userRole</span><span class="params">(@RequestParam(<span class="string">"uid"</span>)</span> Integer uid, @<span class="title">RequestParam</span><span class="params">(<span class="string">"rids"</span>)</span> String rids,</span></span><br><span class="line"><span class="function">          @<span class="title">RequestParam</span><span class="params">(<span class="string">"opt"</span>)</span> String opt) </span>&#123;</span><br><span class="line">      System.out.println(<span class="string">"添加移除用户角色==================&gt;"</span>);</span><br><span class="line">      System.out.println(<span class="string">"用户id-----角色ids------类型：添加、移除"</span>);</span><br><span class="line">      System.out.println(uid);</span><br><span class="line">      System.out.println(rids);</span><br><span class="line">      System.out.println(opt);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (<span class="string">"add"</span>.equals(opt)) &#123;</span><br><span class="line">          <span class="comment">// 为某个用户添加角色</span></span><br><span class="line">          <span class="keyword">int</span> i = userRoleService.add(uid, rids);</span><br><span class="line"></span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="string">"remove"</span>.equals(opt)) &#123;</span><br><span class="line">          <span class="comment">// 为某个用户删除角色</span></span><br><span class="line">          <span class="keyword">int</span> i = userRoleService.remove(uid, rids);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">return</span> <span class="string">"success"</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@RequestMapping</span>(<span class="string">"/toAssignRolePage"</span>)</span><br><span class="line">  <span class="function"><span class="keyword">public</span> String <span class="title">toAssignRolePage</span><span class="params">(@RequestParam(value = <span class="string">"uid"</span>)</span> Integer uid, Model model) </span>&#123;</span><br><span class="line">      System.out.println(<span class="string">"UserController.toAssignRolePage去分配角色页面=============&gt;"</span>);</span><br><span class="line">      <span class="comment">// 1、查出所有角色</span></span><br><span class="line">      List&lt;TRole&gt; list_role = roleService.getAllRole();</span><br><span class="line">      System.out.println(<span class="string">"所有角色===========&gt;"</span>);</span><br><span class="line">      System.out.println(list_role);</span><br><span class="line">      <span class="comment">// 2、查出当前用户拥有的角色</span></span><br><span class="line">      List&lt;TRole&gt; list_user_role = roleService.getUserRole(uid);</span><br><span class="line">      System.out.println(<span class="string">"当前用户的角色==========&gt;"</span>);</span><br><span class="line">      System.out.println(list_user_role);</span><br><span class="line">      HashMap&lt;Integer, TRole&gt; map_user_role = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">      <span class="keyword">for</span> (TRole tRole : list_user_role) &#123;</span><br><span class="line">          map_user_role.put(tRole.getId(), tRole);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">// 3、用户未分配的角色</span></span><br><span class="line">      ArrayList&lt;TRole&gt; list_user_unrole = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">      <span class="keyword">for</span> (TRole tRole : list_role) &#123;</span><br><span class="line">          <span class="keyword">if</span> (!map_user_role.containsKey(tRole.getId())) &#123;</span><br><span class="line">              list_user_unrole.add(tRole);</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      System.out.println(<span class="string">"用户未分配的角色=============&gt;"</span>);</span><br><span class="line">      System.out.println(list_user_unrole);</span><br><span class="line">      model.addAttribute(<span class="string">"list_user_role"</span>, list_user_role);</span><br><span class="line">      model.addAttribute(<span class="string">"list_user_unrole"</span>, list_user_unrole);</span><br><span class="line">      <span class="comment">// model.addAttribute("uid", uid);</span></span><br><span class="line">      <span class="keyword">return</span> <span class="string">"manager/permission/assignRole"</span>;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p>sql:</p>
<p>1)用户表、用户_角色表、角色表3个表多表查询</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">"BaseResultMap"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">type</span>=<span class="string">"com.atguigu.scw.manager.bean.TRole"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">"id"</span> <span class="attr">jdbcType</span>=<span class="string">"INTEGER"</span> <span class="attr">property</span>=<span class="string">"id"</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"name"</span> <span class="attr">jdbcType</span>=<span class="string">"VARCHAR"</span> <span class="attr">property</span>=<span class="string">"name"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- List&lt;TRole&gt; getUserRole(Integer uid); --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"getUserRole"</span> <span class="attr">resultMap</span>=<span class="string">"BaseResultMap"</span>&gt;</span></span><br><span class="line">	SELECT</span><br><span class="line">	a.*</span><br><span class="line">	FROM</span><br><span class="line">	t_role a</span><br><span class="line">	LEFT JOIN t_user_role b</span><br><span class="line">	ON a.`id` = b.`roleid`</span><br><span class="line">	LEFT JOIN t_user c</span><br><span class="line">	ON b.`userid` = c.`id`</span><br><span class="line">	WHERE c.`id` = #&#123;uid&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>2、角色维护权限树</p>
<p>效果图：</p>
<p><img src="https://i.imgur.com/U4cB5aj.png" alt=""></p>
<p><img src="https://i.imgur.com/Yd4wo1a.png" alt=""></p>
<p>实现思路：</p>
<p>1）zTree展示权限树，初始化含有复选框的权限树，异步请求控制层（参数：角色rid）查询出角色拥有的权限</p>
<p>2）点击分配权限携带角色rid和权限permission_ids到控制层，先删除角色所拥有的权限，再更加permission_ids更新角色拥有的权限，同步到前端</p>
<p>3）bootstrap模态框–分配权限按钮绑定参数</p>
<p><img src="https://i.imgur.com/mAxFNQa.png" alt=""></p>
<p><img src="https://i.imgur.com/EHO2nFc.png" alt=""></p>
<p>前端：</p>
<p>1）zTree权限树复选框初始化的时候刚开始使用2次异步请求（一次请求所有权限，一次请求角色拥有的权限），展示数据有点混乱，后来改为一次异步请求同时查询出（所有权限、角色拥有的权限）。</p>
<p>2）bootstrap自定义图标显示不出来</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- Modal模态框 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"modal fade"</span> <span class="attr">id</span>=<span class="string">"permissModel"</span> <span class="attr">tabindex</span>=<span class="string">"-1"</span> <span class="attr">role</span>=<span class="string">"dialog"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">aria-labelledby</span>=<span class="string">"myModalLabel"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"modal-dialog"</span> <span class="attr">role</span>=<span class="string">"document"</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"modal-content"</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"modal-header"</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">class</span>=<span class="string">"close"</span> <span class="attr">data-dismiss</span>=<span class="string">"modal"</span></span></span><br><span class="line"><span class="tag">					<span class="attr">aria-label</span>=<span class="string">"Close"</span>&gt;</span></span><br><span class="line">					<span class="tag">&lt;<span class="name">span</span> <span class="attr">aria-hidden</span>=<span class="string">"true"</span>&gt;</span>&amp;times;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">h4</span> <span class="attr">class</span>=<span class="string">"modal-title"</span> <span class="attr">id</span>=<span class="string">"myModalLabel"</span>&gt;</span>Modal title<span class="tag">&lt;/<span class="name">h4</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"modal-body"</span>&gt;</span></span><br><span class="line">				<span class="comment">&lt;!--展示权限树  --&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">ul</span> <span class="attr">id</span>=<span class="string">"permissionTree"</span> <span class="attr">class</span>=<span class="string">"ztree"</span>&gt;</span><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"modal-footer"</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">class</span>=<span class="string">"btn btn-default"</span> <span class="attr">data-dismiss</span>=<span class="string">"modal"</span>&gt;</span>关闭<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">class</span>=<span class="string">"btn btn-primary"</span> <span class="attr">id</span>=<span class="string">'addPermissionBtn'</span>&gt;</span>分配权限<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript">	$(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">		$(<span class="string">".list-group-item"</span>).click(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">			<span class="keyword">if</span> ($(<span class="keyword">this</span>).find(<span class="string">"ul"</span>)) &#123;</span></span><br><span class="line"><span class="javascript">				$(<span class="keyword">this</span>).toggleClass(<span class="string">"tree-closed"</span>);</span></span><br><span class="line"><span class="javascript">				<span class="keyword">if</span> ($(<span class="keyword">this</span>).hasClass(<span class="string">"tree-closed"</span>)) &#123;</span></span><br><span class="line"><span class="javascript">					$(<span class="string">"ul"</span>, <span class="keyword">this</span>).hide(<span class="string">"fast"</span>);</span></span><br><span class="line"><span class="javascript">				&#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="javascript">					$(<span class="string">"ul"</span>, <span class="keyword">this</span>).show(<span class="string">"fast"</span>);</span></span><br><span class="line"><span class="undefined">				&#125;</span></span><br><span class="line"><span class="undefined">			&#125;</span></span><br><span class="line"><span class="undefined">		&#125;);</span></span><br><span class="line"><span class="undefined">	&#125;);</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="undefined">	/* $("tbody .btn-success").click(function() &#123;</span></span><br><span class="line"><span class="javascript">		<span class="built_in">window</span>.location.href = <span class="string">"assignPermission.html"</span>;</span></span><br><span class="line"><span class="undefined">	&#125;); */</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">	<span class="keyword">var</span> zTree</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">	<span class="comment">//设置ajax同步</span></span></span><br><span class="line"><span class="javascript">	<span class="comment">//$.ajaxSettings.async = false</span></span></span><br><span class="line"><span class="javascript">	<span class="keyword">var</span> assignPermissionEvent = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">		$(<span class="string">".assignPermissionModelBtn"</span>).click(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">			log(<span class="string">'assignPermissionEvent==============&gt;'</span>)</span></span><br><span class="line"><span class="javascript">			<span class="comment">//获取当前角色id</span></span></span><br><span class="line"><span class="javascript">			log(<span class="string">'当前角色id==========&gt;'</span>, $(<span class="keyword">this</span>).attr(<span class="string">'rid'</span>))</span></span><br><span class="line"><span class="javascript">			<span class="keyword">var</span> rid = $(<span class="keyword">this</span>).attr(<span class="string">'rid'</span>)</span></span><br><span class="line"><span class="undefined">			loadModalAndTree(rid)</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="undefined">		&#125;)</span></span><br><span class="line"><span class="undefined">	&#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">	<span class="keyword">var</span> loadModalAndTree = <span class="function"><span class="keyword">function</span>(<span class="params">rid</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">		<span class="comment">//模态框设置</span></span></span><br><span class="line"><span class="javascript">		<span class="keyword">var</span> options = &#123;</span></span><br><span class="line"><span class="javascript">			backdrop : <span class="string">'static'</span>,</span></span><br><span class="line"><span class="javascript">			show : <span class="literal">true</span></span></span><br><span class="line"><span class="undefined">		&#125;</span></span><br><span class="line"><span class="javascript">		<span class="comment">//手动打开模态框</span></span></span><br><span class="line"><span class="javascript">		$(<span class="string">'#permissModel'</span>).modal(options)</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">		<span class="comment">//从数据库查出的所有权限节点数据</span></span></span><br><span class="line"><span class="javascript">		<span class="comment">//发送ajax请求获取到所有权限的json数据</span></span></span><br><span class="line"><span class="javascript">		<span class="keyword">var</span> url = <span class="string">'$&#123;ctp&#125;/permission/role/json/'</span> + rid</span></span><br><span class="line"><span class="javascript">		$.getJSON(url, fns)</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">		<span class="comment">//将角色id保存到模态框的哪个属性中；</span></span></span><br><span class="line"><span class="javascript">		<span class="comment">//打开模态框将角色id传递给model里面的权限分配按钮</span></span></span><br><span class="line"><span class="javascript">		log(<span class="string">'角色id===========&gt;'</span>, rid)</span></span><br><span class="line"><span class="javascript">		$(<span class="string">'#addPermissionBtn'</span>).attr(<span class="string">"rid"</span>, rid)</span></span><br><span class="line"><span class="undefined">	&#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">	<span class="comment">//成功回调函数，刷新权限树</span></span></span><br><span class="line"><span class="javascript">	<span class="keyword">var</span> fns = <span class="function"><span class="keyword">function</span>(<span class="params">data</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">		log(<span class="string">'成功返回数据'</span>, data)</span></span><br><span class="line"><span class="javascript">		log(<span class="string">'event==========&gt;'</span>, event)</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">		<span class="keyword">var</span> ids = []</span></span><br><span class="line"><span class="javascript">		$.each(data.listCurrentPermission, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">			ids.push(<span class="keyword">this</span>.id)</span></span><br><span class="line"><span class="undefined">		&#125;)</span></span><br><span class="line"><span class="javascript">		log(<span class="string">'ids===========&gt;'</span>, ids)</span></span><br><span class="line"><span class="javascript">		<span class="comment">//遍历每一条权限</span></span></span><br><span class="line"><span class="javascript">		$.each(data.listPermission, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">			<span class="comment">//给每一个节点修改或者添加一些属性</span></span></span><br><span class="line"><span class="javascript">			<span class="keyword">if</span> (<span class="keyword">this</span>.pid == <span class="number">0</span>) &#123;</span></span><br><span class="line"><span class="javascript">				<span class="keyword">this</span>.open = <span class="literal">true</span></span></span><br><span class="line"><span class="undefined">			&#125;</span></span><br><span class="line"><span class="javascript">			<span class="keyword">if</span> (ids.includes(<span class="keyword">this</span>.id)) &#123;</span></span><br><span class="line"><span class="javascript">				<span class="keyword">this</span>.checked = <span class="literal">true</span></span></span><br><span class="line"><span class="undefined">			&#125;</span></span><br><span class="line"><span class="undefined">		&#125;)</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">		<span class="keyword">var</span> setting = &#123;</span></span><br><span class="line"><span class="undefined">			data : &#123;</span></span><br><span class="line"><span class="undefined">				simpleData : &#123;</span></span><br><span class="line"><span class="javascript">					enable : <span class="literal">true</span>,</span></span><br><span class="line"><span class="javascript">					idKey : <span class="string">"id"</span>,</span></span><br><span class="line"><span class="javascript">					pIdKey : <span class="string">"pid"</span>,</span></span><br><span class="line"><span class="undefined">				&#125;,</span></span><br><span class="line"><span class="undefined">				key : &#123;</span></span><br><span class="line"><span class="javascript">					url : <span class="string">"haha"</span></span></span><br><span class="line"><span class="undefined">				&#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="undefined">			&#125;,</span></span><br><span class="line"><span class="undefined">			/* view : &#123;</span></span><br><span class="line"><span class="undefined">				addDiyDom : showIcon</span></span><br><span class="line"><span class="undefined">			&#125;, */</span></span><br><span class="line"><span class="undefined">			check : &#123;</span></span><br><span class="line"><span class="javascript">				enable : <span class="literal">true</span></span></span><br><span class="line"><span class="undefined">			&#125;</span></span><br><span class="line"><span class="undefined">		&#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">		zTree = $.fn.zTree.init($(<span class="string">"#permissionTree"</span>), setting,</span></span><br><span class="line"><span class="undefined">				data.listPermission)</span></span><br><span class="line"><span class="javascript">		log(<span class="string">'zTree赋值完成==========&gt;'</span>, zTree)</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="undefined">	&#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">	<span class="comment">//用于在节点上固定显示用户自定义控件</span></span></span><br><span class="line"><span class="javascript">	<span class="comment">//?图标无法正常显示可能是字体样式没有引入进来</span></span></span><br><span class="line"><span class="javascript">	<span class="keyword">var</span> showIcon = <span class="function"><span class="keyword">function</span>(<span class="params">treeId, treeNode</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">		log(<span class="string">'自定义显示图标==============&gt;'</span>)</span></span><br><span class="line"><span class="javascript">		log(<span class="string">'treeId===============&gt;'</span>, treeId)</span></span><br><span class="line"><span class="javascript">		log(<span class="string">'treeNode===============&gt;'</span>, treeNode)</span></span><br><span class="line"><span class="javascript">		<span class="comment">//#permissionTree_10_ico</span></span></span><br><span class="line"><span class="javascript">		$(<span class="string">"#"</span> + treeNode.tId + <span class="string">"_ico"</span>).removeClass()</span></span><br><span class="line"><span class="undefined">				.addClass(treeNode.icon)</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="undefined">	&#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">	<span class="comment">//默认勾选当前角色的权限</span></span></span><br><span class="line"><span class="javascript">	<span class="keyword">var</span> checkcurPermisson = <span class="function"><span class="keyword">function</span>(<span class="params">rid</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">		<span class="keyword">var</span> url = <span class="string">'$&#123;ctp&#125;/permission/role/curPermission/'</span> + rid</span></span><br><span class="line"><span class="javascript">		$.getJSON(url, fns2)</span></span><br><span class="line"><span class="undefined">	&#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">	<span class="comment">//获取当前角色权限成功回调函数</span></span></span><br><span class="line"><span class="javascript">	<span class="keyword">var</span> fns2 = <span class="function"><span class="keyword">function</span>(<span class="params">data</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">		log(<span class="string">'fns2===============&gt;'</span>)</span></span><br><span class="line"><span class="javascript">		log(<span class="string">'fns2_data================'</span>, data)</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">		<span class="comment">//遍历当前角色拥有的权限</span></span></span><br><span class="line"><span class="javascript">		$.each(data, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">			<span class="comment">//$(this).attr('id')</span></span></span><br><span class="line"><span class="javascript">			<span class="keyword">var</span> node = zTree.getNodesByParam(<span class="string">'id'</span>, <span class="keyword">this</span>.id, <span class="literal">null</span>)</span></span><br><span class="line"><span class="javascript">			log(<span class="string">'使用zTree===========&gt;'</span>, zTree)</span></span><br><span class="line"><span class="javascript">			log(<span class="string">'当前角色拥有的权限=============&gt;'</span>, node)</span></span><br><span class="line"><span class="javascript">			zTree.checkNode(node, <span class="literal">true</span>, <span class="literal">false</span>)</span></span><br><span class="line"><span class="javascript">			log(<span class="string">'是否选中=========&gt;'</span>, node.checked)</span></span><br><span class="line"><span class="javascript">			node.nocheck = <span class="literal">true</span> <span class="comment">//表示显示checkbox</span></span></span><br><span class="line"><span class="undefined">		&#125;)</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="undefined">	&#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">	<span class="comment">//更新权限树</span></span></span><br><span class="line"><span class="javascript">	<span class="keyword">var</span> updateTree = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">		log(<span class="string">'更新权限树===========&gt;'</span>)</span></span><br><span class="line"><span class="javascript">		<span class="keyword">var</span> rid = $(<span class="string">'#addPermissionBtn'</span>).attr(<span class="string">"rid"</span>)</span></span><br><span class="line"><span class="javascript">		log(<span class="string">'角色rid==========&gt;'</span>, rid)</span></span><br><span class="line"><span class="javascript">		<span class="keyword">var</span> permission_ids = <span class="string">''</span></span></span><br><span class="line"><span class="javascript">		<span class="comment">//1、获取当前我们已经选中的权限</span></span></span><br><span class="line"><span class="javascript">		<span class="keyword">var</span> nodes = zTree.getCheckedNodes(<span class="literal">true</span>)</span></span><br><span class="line"><span class="javascript">		log(<span class="string">'nodes=============&gt;'</span>, nodes)</span></span><br><span class="line"><span class="javascript">		$.each(nodes, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">			permission_ids += <span class="keyword">this</span>.id + <span class="string">','</span></span></span><br><span class="line"><span class="undefined">		&#125;)</span></span><br><span class="line"><span class="javascript">		<span class="keyword">var</span> url = <span class="string">'$&#123;ctp&#125;/permission/role/update?rid='</span> + rid</span></span><br><span class="line"><span class="javascript">				+ <span class="string">'&amp;permission_ids='</span> + permission_ids</span></span><br><span class="line"><span class="javascript">		$.get(url, updateTreeFn)</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="undefined">	&#125;</span></span><br><span class="line"><span class="javascript">	<span class="comment">//更新权限树回调函数</span></span></span><br><span class="line"><span class="javascript">	<span class="keyword">var</span> updateTreeFn = <span class="function"><span class="keyword">function</span>(<span class="params">data</span>) </span>&#123;</span></span><br><span class="line"><span class="undefined">		alert(data)</span></span><br><span class="line"><span class="javascript">		log(<span class="string">"权限分配成功===========&gt;"</span>);</span></span><br><span class="line"><span class="javascript">		$(<span class="string">'#permissModel'</span>).modal(<span class="string">"hide"</span>);</span></span><br><span class="line"><span class="undefined">	&#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">	<span class="keyword">var</span> addPermissionBtnEvent = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">		$(<span class="string">'#addPermissionBtn'</span>).click(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">			log(<span class="string">'点击分配权限按钮=============&gt;'</span>)</span></span><br><span class="line"><span class="undefined">			updateTree()</span></span><br><span class="line"><span class="undefined">		&#125;)</span></span><br><span class="line"><span class="undefined">	&#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">	<span class="keyword">var</span> __main = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="undefined">		assignPermissionEvent()</span></span><br><span class="line"><span class="undefined">		addPermissionBtnEvent()</span></span><br><span class="line"><span class="undefined">	&#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">	$(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="undefined">		__main()</span></span><br><span class="line"><span class="undefined">	&#125;)</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>控制层：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">//分配权限</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/update"</span>)</span><br><span class="line">   <span class="meta">@ResponseBody</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> String <span class="title">updateRolePermission</span><span class="params">(@RequestParam(<span class="string">"rid"</span>)</span> Integer rid,</span></span><br><span class="line"><span class="function">           @<span class="title">RequestParam</span><span class="params">(<span class="string">"permission_ids"</span>)</span> String permission_ids) </span>&#123;</span><br><span class="line">       System.out.println(<span class="string">"更新权限==========&gt;"</span>);</span><br><span class="line">       System.out.println(rid);</span><br><span class="line">       System.out.println(permission_ids);</span><br><span class="line">       <span class="comment">// 先删除该角色所有权限，在为该用户分配权限</span></span><br><span class="line">       <span class="keyword">boolean</span> flag = rolePermissionService.updatePermission(rid, permission_ids);</span><br><span class="line"></span><br><span class="line">       <span class="keyword">return</span> flag ? <span class="string">"success"</span> : <span class="string">"fail"</span>;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@RequestMapping</span>(<span class="string">"/curPermission/&#123;id&#125;"</span>)</span><br><span class="line">   <span class="meta">@ResponseBody</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> List&lt;TPermission&gt; <span class="title">getCurrentPermission</span><span class="params">(@PathVariable(<span class="string">"id"</span>)</span> Integer rid) </span>&#123;</span><br><span class="line">       System.out.println(<span class="string">"当前角色拥有的权限==============&gt;"</span>);</span><br><span class="line">       List&lt;TPermission&gt; listPermission = permissionService.getPermissionsById(rid);</span><br><span class="line">       System.out.println(listPermission);</span><br><span class="line">       <span class="keyword">return</span> listPermission;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//查出角色拥有的权限、所有权限</span></span><br><span class="line">   <span class="meta">@RequestMapping</span>(<span class="string">"/json/&#123;id&#125;"</span>)</span><br><span class="line">   <span class="meta">@ResponseBody</span></span><br><span class="line">   <span class="keyword">public</span> HashMap&lt;String, List&lt;TPermission&gt;&gt; getAllPermission(<span class="meta">@PathVariable</span>(<span class="string">"id"</span>) Integer rid) &#123;</span><br><span class="line"></span><br><span class="line">       List&lt;TPermission&gt; listPermission = permissionService.getPermissions();</span><br><span class="line">       List&lt;TPermission&gt; listCurrentPermission = permissionService.getPermissionsById(rid);</span><br><span class="line">       HashMap&lt;String, List&lt;TPermission&gt;&gt; map = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">       map.put(<span class="string">"listPermission"</span>, listPermission);</span><br><span class="line">       map.put(<span class="string">"listCurrentPermission"</span>, listCurrentPermission);</span><br><span class="line">       <span class="keyword">return</span> map;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<p>业务层：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// 更新权限树</span></span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">updatePermission</span><span class="params">(Integer rid, String permission_ids)</span> </span>&#123;</span><br><span class="line">       <span class="comment">// 删除角色权限</span></span><br><span class="line">       TRolePermissionExample tRolePermissionExample = <span class="keyword">new</span> TRolePermissionExample();</span><br><span class="line">       Criteria criteria = tRolePermissionExample.createCriteria();</span><br><span class="line">       criteria.andRoleidEqualTo(rid);</span><br><span class="line">       <span class="keyword">int</span> count = mapper.deleteByExample(tRolePermissionExample);</span><br><span class="line"></span><br><span class="line">       <span class="comment">// 更新权限</span></span><br><span class="line">       <span class="keyword">if</span> (permission_ids.contains(<span class="string">","</span>)) &#123;</span><br><span class="line">           String[] split = permission_ids.split(<span class="string">","</span>);</span><br><span class="line">           <span class="keyword">for</span> (String permission_id : split) &#123;</span><br><span class="line">               <span class="keyword">int</span> i = Integer.parseInt(permission_id);</span><br><span class="line">               TRolePermission rolePermission = <span class="keyword">new</span> TRolePermission();</span><br><span class="line">               <span class="comment">// 设置权限id</span></span><br><span class="line">               rolePermission.setPermissionid(i);</span><br><span class="line">               <span class="comment">// 设置角色id</span></span><br><span class="line">               rolePermission.setRoleid(rid);</span><br><span class="line">               <span class="comment">// 保存角色权限关系</span></span><br><span class="line">               mapper.insertSelective(rolePermission);</span><br><span class="line">           &#125;</span><br><span class="line"></span><br><span class="line">       &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">           <span class="keyword">int</span> i = Integer.parseInt(permission_ids);</span><br><span class="line">           TRolePermission rolePermission = <span class="keyword">new</span> TRolePermission();</span><br><span class="line">           <span class="comment">// 设置权限id</span></span><br><span class="line">           rolePermission.setPermissionid(i);</span><br><span class="line">           <span class="comment">// 设置角色id</span></span><br><span class="line">           rolePermission.setRoleid(rid);</span><br><span class="line">           <span class="comment">// 保存角色权限关系</span></span><br><span class="line">           mapper.insertSelective(rolePermission);</span><br><span class="line"></span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> <span class="comment">// 为角色分配权限，查询所有权限</span></span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> List&lt;TPermission&gt; <span class="title">getPermissions</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">       List&lt;TPermission&gt; list_permission = mapper.selectByExample(<span class="keyword">null</span>);</span><br><span class="line">       <span class="keyword">return</span> list_permission;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> List&lt;TPermission&gt; <span class="title">getPermissionsById</span><span class="params">(Integer rid)</span> </span>&#123;</span><br><span class="line">       List&lt;TPermission&gt; list_permission = mapper.getRolePermission(rid);</span><br><span class="line">       <span class="keyword">return</span> list_permission;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://shenlibing.github.io/myhexo/myhexo/2019/01/13/网易邮箱服务器发送电子邮件_搭建James邮件服务器发送电子邮件/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="shenlibing">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/myhexo/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="小兵兵">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/myhexo/2019/01/13/网易邮箱服务器发送电子邮件_搭建James邮件服务器发送电子邮件/" class="post-title-link" itemprop="url">网易邮箱服务器发送电子邮件_搭建James邮件服务器发送电子邮件</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2019-01-13 12:58:55" itemprop="dateCreated datePublished" datetime="2019-01-13T12:58:55+08:00">2019-01-13</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-01-22 17:35:22" itemprop="dateModified" datetime="2019-01-22T17:35:22+08:00">2019-01-22</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/myhexo/categories/日常记录/" itemprop="url" rel="index"><span itemprop="name">日常记录</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          
            <span id="/myhexo/2019/01/13/网易邮箱服务器发送电子邮件_搭建James邮件服务器发送电子邮件/" class="leancloud_visitors" data-flag-title="网易邮箱服务器发送电子邮件_搭建James邮件服务器发送电子邮件">
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              
                <span class="post-meta-item-text">阅读次数：</span>
              
                <span class="leancloud-visitors-count"></span>
            </span>
          

          

          
            <div class="post-symbolscount">
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">本文字数：</span>
                
                <span title="本文字数">16k</span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">14 分钟</span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>1、网易邮箱发送电子邮件</p>
<p>为了安全，网易邮箱开启pop3授权码验证，该授权码可以让客户端进行登录</p>
<p><img src="https://i.imgur.com/MepAaVz.png" alt=""></p>
<p><img src="https://i.imgur.com/BzfesnI.png" alt=""></p>
<p>qq开启授权码</p>
<p><a href="https://service.mail.qq.com/cgi-bin/help?subtype=1&amp;&amp;no=1001256&amp;&amp;id=28" target="_blank" rel="noopener">https://service.mail.qq.com/cgi-bin/help?subtype=1&amp;&amp;no=1001256&amp;&amp;id=28</a></p>
<p>实现：<br>JavaMailAPI使用比较麻烦，这里采用的是Apache Commons Email</p>
<p>导入依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/org.apache.commons/commons-email --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.commons<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-email<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.4<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>测试：<br>A simple text email</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">@Test</span><br><span class="line">   public void test01() throws Exception &#123;</span><br><span class="line">       SimpleEmail email = new SimpleEmail();</span><br><span class="line">       // 设置主机名，远程服务器的主机名</span><br><span class="line">       email.setHostName(&quot;smtp.163.com&quot;);</span><br><span class="line">       email.setSmtpPort(25);</span><br><span class="line">       // 设置登陆远程服务器的账号和pop3授权码</span><br><span class="line">       email.setAuthentication(&quot;15501892660@163.com&quot;, &quot;xxxxxxx&quot;);</span><br><span class="line"></span><br><span class="line">       // 编写一个邮件</span><br><span class="line">       // 设置发送给谁</span><br><span class="line">       email.addTo(&quot;782125244@qq.com&quot;);</span><br><span class="line">       // 设置这个邮件来源于哪里</span><br><span class="line">       email.setFrom(&quot;15501892660@163.com&quot;);</span><br><span class="line">       // 设置邮件主题</span><br><span class="line">       email.setSubject(&quot;163发给qq的测试邮件 &quot;);</span><br><span class="line">       // 设置邮件内容</span><br><span class="line">       email.setMsg(&quot;测试邮件&quot;);</span><br><span class="line">       // 邮件发送</span><br><span class="line">       email.send();</span><br><span class="line"></span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<p>参考：</p>
<p><a href="http://commons.apache.org/proper/commons-email/userguide.html" target="_blank" rel="noopener">http://commons.apache.org/proper/commons-email/userguide.html</a></p>
<p>2、搭建James邮件服务器</p>
<p>下载</p>
<p><a href="https://archive.apache.org/dist/james/server/" target="_blank" rel="noopener">https://archive.apache.org/dist/james/server/</a></p>
<p>quick-start</p>
<p><a href="http://james.apache.org/server/quick-start.html" target="_blank" rel="noopener">http://james.apache.org/server/quick-start.html</a></p>
<p>解压</p>
<p>D:\devsoft\apache-james-3.0-beta4</p>
<p><img src="https://i.imgur.com/nR79WWy.png" alt=""></p>
<p>建库</p>
<p><img src="https://i.imgur.com/kj3faWO.png" alt=""></p>
<p>配置数据源</p>
<p><img src="https://i.imgur.com/9l952KR.png" alt=""></p>
<p><img src="https://i.imgur.com/1PeU0yW.png" alt=""></p>
<p>启动</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">D:\devsoft\apache-james-3.0-beta4\bin&gt;run.bat</span><br><span class="line">INFO  09:28:46,331 | org.apache.james.container.spring.context.JamesServerApplicationContext | Refreshing org.apache.james.container.spring.context.JamesServerApplicationContext@153f5a29: startup date [Thu Jan 03 09:28:46 CST 2019]; root of context hierarchy</span><br><span class="line">Exception in thread &quot;main&quot; org.springframework.beans.factory.BeanDefinitionStoreException: Failed to create the JAXB binder; nested exception is javax.xml.bind.JAXBException: Provider com.sun.xml.internal.bind.v2.ContextFactory could not be instantiated: com.sun.xml.internal.bind.v2.runtime.IllegalAnnotationsException: 1 counts of IllegalAnnotationExceptions</span><br><span class="line">类的两个属性具有相同名称 &quot;outputs&quot;</span><br><span class="line">        this problem is related to the following location:</span><br><span class="line">                at public java.util.List org.apache.camel.model.ResequenceDefinition.getOutputs()</span><br><span class="line">                at org.apache.camel.model.ResequenceDefinition</span><br><span class="line">        this problem is related to the following location:</span><br><span class="line">                at private java.util.List org.apache.camel.model.ResequenceDefinition.outputs</span><br><span class="line">                at org.apache.camel.model.ResequenceDefinition</span><br><span class="line"></span><br><span class="line"> - with linked exception:</span><br><span class="line">[com.sun.xml.internal.bind.v2.runtime.IllegalAnnotationsException: 1 counts of IllegalAnnotationExceptions</span><br><span class="line">类的两个属性具有相同名称 &quot;outputs&quot;</span><br><span class="line">        this problem is related to the following location:</span><br><span class="line">                at public java.util.List org.apache.camel.model.ResequenceDefinition.getOutputs()</span><br><span class="line">                at org.apache.camel.model.ResequenceDefinition</span><br><span class="line">        this problem is related to the following location:</span><br><span class="line">                at private java.util.List org.apache.camel.model.ResequenceDefinition.outputs</span><br><span class="line">                at org.apache.camel.model.ResequenceDefinition</span><br><span class="line">]</span><br><span class="line">        at org.apache.camel.spring.handler.CamelNamespaceHandler$CamelContextBeanDefinitionParser.doParse(CamelNamespaceHandler.java:258)</span><br><span class="line">        at org.springframework.beans.factory.xml.AbstractSingleBeanDefinitionParser.parseInternal(AbstractSingleBeanDefinitionParser.java:85)</span><br><span class="line">        at org.springframework.beans.factory.xml.AbstractBeanDefinitionParser.parse(AbstractBeanDefinitionParser.java:59)</span><br><span class="line">        at org.springframework.beans.factory.xml.NamespaceHandlerSupport.parse(NamespaceHandlerSupport.java:73)</span><br><span class="line">        at org.springframework.beans.factory.xml.BeanDefinitionParserDelegate.parseCustomElement(BeanDefinitionParserDelegate.java:1419)</span><br><span class="line">        at org.springframework.beans.factory.xml.BeanDefinitionParserDelegate.parseCustomElement(BeanDefinitionParserDelegate.java:1409)</span><br><span class="line">        at org.springframework.beans.factory.xml.DefaultBeanDefinitionDocumentReader.parseBeanDefinitions(DefaultBeanDefinitionDocumentReader.java:184)</span><br><span class="line">        at org.springframework.beans.factory.xml.DefaultBeanDefinitionDocumentReader.doRegisterBeanDefinitions(DefaultBeanDefinitionDocumentReader.java:140)</span><br><span class="line">        at org.springframework.beans.factory.xml.DefaultBeanDefinitionDocumentReader.registerBeanDefinitions(DefaultBeanDefinitionDocumentReader.java:111)</span><br><span class="line">        at org.springframework.beans.factory.xml.XmlBeanDefinitionReader.registerBeanDefinitions(XmlBeanDefinitionReader.java:493)</span><br><span class="line">        at org.springframework.beans.factory.xml.XmlBeanDefinitionReader.doLoadBeanDefinitions(XmlBeanDefinitionReader.java:390)</span><br><span class="line">        at org.springframework.beans.factory.xml.XmlBeanDefinitionReader.loadBeanDefinitions(XmlBeanDefinitionReader.java:334)</span><br><span class="line">        at org.springframework.beans.factory.xml.XmlBeanDefinitionReader.loadBeanDefinitions(XmlBeanDefinitionReader.java:302)</span><br><span class="line">        at org.springframework.beans.factory.support.AbstractBeanDefinitionReader.loadBeanDefinitions(AbstractBeanDefinitionReader.java:174)</span><br><span class="line">        at org.springframework.beans.factory.support.AbstractBeanDefinitionReader.loadBeanDefinitions(AbstractBeanDefinitionReader.java:209)</span><br><span class="line">        at org.springframework.beans.factory.support.AbstractBeanDefinitionReader.loadBeanDefinitions(AbstractBeanDefinitionReader.java:180)</span><br><span class="line">        at org.springframework.beans.factory.support.AbstractBeanDefinitionReader.loadBeanDefinitions(AbstractBeanDefinitionReader.java:243)</span><br><span class="line">        at org.springframework.context.support.AbstractXmlApplicationContext.loadBeanDefinitions(AbstractXmlApplicationContext.java:127)</span><br><span class="line">        at org.springframework.context.support.AbstractXmlApplicationContext.loadBeanDefinitions(AbstractXmlApplicationContext.java:93)</span><br><span class="line">        at org.springframework.context.support.AbstractRefreshableApplicationContext.refreshBeanFactory(AbstractRefreshableApplicationContext.java:131)</span><br><span class="line">        at org.springframework.context.support.AbstractApplicationContext.obtainFreshBeanFactory(AbstractApplicationContext.java:522)</span><br><span class="line">        at org.springframework.context.support.AbstractApplicationContext.refresh(AbstractApplicationContext.java:436)</span><br><span class="line">        at org.springframework.context.support.ClassPathXmlApplicationContext.&lt;init&gt;(ClassPathXmlApplicationContext.java:139)</span><br><span class="line">        at org.springframework.context.support.ClassPathXmlApplicationContext.&lt;init&gt;(ClassPathXmlApplicationContext.java:93)</span><br><span class="line">        at org.apache.james.container.spring.context.JamesServerApplicationContext.&lt;init&gt;(JamesServerApplicationContext.java:39)</span><br><span class="line">        at org.apache.james.app.spring.JamesAppSpringMain.init(JamesAppSpringMain.java:61)</span><br><span class="line">        at org.apache.james.app.spring.JamesAppSpringMain.main(JamesAppSpringMain.java:42)</span><br><span class="line">Caused by: javax.xml.bind.JAXBException: Provider com.sun.xml.internal.bind.v2.ContextFactory could not be instantiated: com.sun.xml.internal.bind.v2.runtime.IllegalAnnotationsException: 1 counts of IllegalAnnotationExceptions</span><br><span class="line">类的两个属性具有相同名称 &quot;outputs&quot;</span><br><span class="line">        this problem is related to the following location:</span><br><span class="line">                at public java.util.List org.apache.camel.model.ResequenceDefinition.getOutputs()</span><br><span class="line">                at org.apache.camel.model.ResequenceDefinition</span><br><span class="line">        this problem is related to the following location:</span><br><span class="line">                at private java.util.List org.apache.camel.model.ResequenceDefinition.outputs</span><br><span class="line">                at org.apache.camel.model.ResequenceDefinition</span><br><span class="line"></span><br><span class="line"> - with linked exception:</span><br><span class="line">[com.sun.xml.internal.bind.v2.runtime.IllegalAnnotationsException: 1 counts of IllegalAnnotationExceptions</span><br><span class="line">类的两个属性具有相同名称 &quot;outputs&quot;</span><br><span class="line">        this problem is related to the following location:</span><br><span class="line">                at public java.util.List org.apache.camel.model.ResequenceDefinition.getOutputs()</span><br><span class="line">                at org.apache.camel.model.ResequenceDefinition</span><br><span class="line">        this problem is related to the following location:</span><br><span class="line">                at private java.util.List org.apache.camel.model.ResequenceDefinition.outputs</span><br><span class="line">                at org.apache.camel.model.ResequenceDefinition</span><br><span class="line">]</span><br><span class="line">        at javax.xml.bind.ContextFinder.newInstance(ContextFinder.java:146)</span><br><span class="line">        at javax.xml.bind.ContextFinder.find(ContextFinder.java:356)</span><br><span class="line">        at javax.xml.bind.JAXBContext.newInstance(JAXBContext.java:431)</span><br><span class="line">        at javax.xml.bind.JAXBContext.newInstance(JAXBContext.java:394)</span><br><span class="line">        at org.apache.camel.spring.handler.CamelNamespaceHandler.createJaxbContext(CamelNamespaceHandler.java:187)</span><br><span class="line">        at org.apache.camel.spring.handler.CamelNamespaceHandler.getJaxbContext(CamelNamespaceHandler.java:174)</span><br><span class="line">        at org.apache.camel.spring.handler.CamelNamespaceHandler$CamelContextBeanDefinitionParser.doParse(CamelNamespaceHandler.java:256)</span><br><span class="line">        ... 26 more</span><br><span class="line">Caused by: com.sun.xml.internal.bind.v2.runtime.IllegalAnnotationsException: 1 counts of IllegalAnnotationExceptions</span><br><span class="line">类的两个属性具有相同名称 &quot;outputs&quot;</span><br><span class="line">        this problem is related to the following location:</span><br><span class="line">                at public java.util.List org.apache.camel.model.ResequenceDefinition.getOutputs()</span><br><span class="line">                at org.apache.camel.model.ResequenceDefinition</span><br><span class="line">        this problem is related to the following location:</span><br><span class="line">                at private java.util.List org.apache.camel.model.ResequenceDefinition.outputs</span><br><span class="line">                at org.apache.camel.model.ResequenceDefinition</span><br><span class="line"></span><br><span class="line">        at com.sun.xml.internal.bind.v2.runtime.IllegalAnnotationsException$Builder.check(IllegalAnnotationsException.java:91)</span><br><span class="line">        at com.sun.xml.internal.bind.v2.runtime.JAXBContextImpl.getTypeInfoSet(JAXBContextImpl.java:445)</span><br><span class="line">        at com.sun.xml.internal.bind.v2.runtime.JAXBContextImpl.&lt;init&gt;(JAXBContextImpl.java:277)</span><br><span class="line">        at com.sun.xml.internal.bind.v2.runtime.JAXBContextImpl.&lt;init&gt;(JAXBContextImpl.java:124)</span><br><span class="line">        at com.sun.xml.internal.bind.v2.runtime.JAXBContextImpl$JAXBContextBuilder.build(JAXBContextImpl.java:1123)</span><br><span class="line">        at com.sun.xml.internal.bind.v2.ContextFactory.createContext(ContextFactory.java:147)</span><br><span class="line">        at com.sun.xml.internal.bind.v2.ContextFactory.createContext(ContextFactory.java:271)</span><br><span class="line">        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)</span><br><span class="line">        at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)</span><br><span class="line">        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)</span><br><span class="line">        at java.lang.reflect.Method.invoke(Method.java:498)</span><br><span class="line">        at javax.xml.bind.ContextFinder.newInstance(ContextFinder.java:171)</span><br><span class="line">        at javax.xml.bind.ContextFinder.newInstance(ContextFinder.java:131)</span><br><span class="line">        ... 32 more</span><br><span class="line"></span><br><span class="line">D:\devsoft\apache-james-3.0-beta4\bin&gt;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line">D:\devsoft\apache-james-3.0-beta4\bin&gt;run.bat</span><br><span class="line">INFO  09:37:44,247 | org.apache.james.container.spring.context.JamesServerApplicationContext | Refreshing org.apache.james.container.spring.context.JamesServerApplicationContext@7ca48474: startup date [Thu Jan 03 09:37:44 CST 2019]; root of context hierarchy</span><br><span class="line">log4j:WARN No appenders could be found for logger (org.apache.commons.configuration.ConfigurationUtils).</span><br><span class="line">log4j:WARN Please initialize the log4j system properly.</span><br><span class="line">log4j:WARN See http://logging.apache.org/log4j/1.2/faq.html#noconfig for more info.</span><br><span class="line">INFO  09:37:45,153 | org.apache.james.container.spring.context.JamesServerApplicationContext | Bean &apos;logprovider&apos; of type [class org.apache.james.container.spring.lifecycle.LogProviderImpl] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)</span><br><span class="line">INFO  09:37:45,544 | james.mailrepositorystore | JamesMailStore init...</span><br><span class="line">INFO  09:37:45,550 | james.mailrepositorystore | Registering Repository instance of class org.apache.james.mailrepository.file.FileMailRepository to handle file protocol requests for repositories with key file</span><br><span class="line">INFO  09:37:45,550 | james.mailrepositorystore | Registering Repository instance of class org.apache.james.mailrepository.jdbc.JDBCMailRepository to handle db protocol requests for repositories with key db</span><br><span class="line">INFO  09:37:45,550 | james.mailrepositorystore | Registering Repository instance of class org.apache.james.mailrepository.jdbc.JDBCMailRepository to handle dbfile protocol requests for repositories with key dbfile</span><br><span class="line">INFO  09:37:45,551 | james.mailrepositorystore | Registering Repository instance of class org.apache.james.mailrepository.file.MBoxMailRepository to handle mbox protocol requests for repositories with key mbox</span><br><span class="line">INFO  09:37:45,936 | james.dnsservice | Autodiscovery is enabled - trying to discover your system&apos;s DNS Servers</span><br><span class="line">INFO  09:37:45,942 | james.dnsservice | Adding autodiscovered server 202.100.192.68</span><br><span class="line">INFO  09:37:45,942 | james.dnsservice | Adding autodiscovered server 202.100.199.8</span><br><span class="line">INFO  09:37:45,943 | james.dnsservice | DNS Server is: 202.100.192.68</span><br><span class="line">INFO  09:37:45,943 | james.dnsservice | DNS Server is: 202.100.199.8</span><br><span class="line">INFO  09:37:45,949 | james.dnsservice | Registered cache, resolver and search paths as DNSJava defaults</span><br><span class="line">12  James  WARN   [main] openjpa.Runtime - An error occurred while registering a ClassTransformer with PersistenceUnitInfo: name &apos;James&apos;, root URL [file:/D:/devsoft/apache-james-3.0-beta4/conf/]. The error has been consumed. To see it, set your openjpa.Runtime log level to TRACE. Load-time class transformation will not be available.</span><br><span class="line">INFO  09:37:55,187 | james.domainlist | Set autodetect to: true</span><br><span class="line">INFO  09:37:55,187 | james.domainlist | Set autodetectIP to: true</span><br><span class="line">28  James  INFO   [main] openjpa.Runtime - Starting OpenJPA 2.1.0</span><br><span class="line">52  James  INFO   [main] openjpa.jdbc.JDBC - Using dictionary class &quot;org.apache.openjpa.jdbc.sql.MySQLDictionary&quot;.</span><br><span class="line">Cannot load JDBC driver class &apos;com.mysql.jdbc.Driver&apos;</span><br><span class="line">java.lang.ClassNotFoundException: com.mysql.jdbc.Driver</span><br><span class="line">        at java.net.URLClassLoader.findClass(URLClassLoader.java:381)</span><br><span class="line">        at java.lang.ClassLoader.loadClass(ClassLoader.java:424)</span><br><span class="line">        at sun.misc.Launcher$AppClassLoader.loadClass(Launcher.java:338)</span><br><span class="line">        at java.lang.ClassLoader.loadClass(ClassLoader.java:357)</span><br><span class="line">        at org.apache.commons.dbcp.BasicDataSource.createConnectionFactory(BasicDataSource.java:1420)</span><br><span class="line">        at org.apache.commons.dbcp.BasicDataSource.createDataSource(BasicDataSource.java:1371)</span><br><span class="line">        at org.apache.commons.dbcp.BasicDataSource.getConnection(BasicDataSource.java:1044)</span><br></pre></td></tr></table></figure>
<p>解决办法</p>
<p>D:\devsoft\apache-james-3.0-beta4\conf\lib：存放自己导入的jar</p>
<p>D:\devsoft\apache-james-3.0-beta4\lib：存放James默认jar</p>
<p>复制jaxb-impl-2.1.3.jar，mysql驱动jar包到conf/lib下</p>
<p><img src="https://i.imgur.com/4wuAqzA.png" alt=""></p>
<p>设置服务器域名、建立账户</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">D:\devsoft\apache-james-3.0-beta4\bin&gt; james-cli.bat -h localhost -p 9999 adddomain atguigu.com</span><br><span class="line">adddomain command executed sucessfully in 106 ms.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">D:\devsoft\apache-james-3.0-beta4\bin&gt; james-cli.bat -h localhost -p 9999 adduser test@atguigu.com test</span><br><span class="line">adduser command executed sucessfully in 94 ms.</span><br></pre></td></tr></table></figure>
<p>配置Foxmail客户端连接James邮件服务器</p>
<p><img src="https://i.imgur.com/f8p6D2w.png" alt=""><br><img src="https://i.imgur.com/9J6L4rf.png" alt=""></p>
<p>测试：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 测试james发送邮件</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@Description</span> (TODO这里用一句话描述这个方法的作用)</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="meta">@Test</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test02</span><span class="params">()</span> <span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line">       SimpleEmail email = <span class="keyword">new</span> SimpleEmail();</span><br><span class="line">       <span class="comment">//设置主机名，远程服务器的主机名</span></span><br><span class="line">       email.setHostName(<span class="string">"127.0.0.1"</span>);</span><br><span class="line">       <span class="comment">//自定义的ip，一定要手动设置好端口号</span></span><br><span class="line">       email.setSmtpPort(<span class="number">25</span>);</span><br><span class="line">       <span class="comment">//设置登陆远程服务器的密码</span></span><br><span class="line">       email.setAuthentication(<span class="string">"test@atguigu.com"</span>, <span class="string">"000000"</span>);</span><br><span class="line"></span><br><span class="line">       <span class="comment">//编写一个邮件</span></span><br><span class="line">       <span class="comment">//设置发送给谁</span></span><br><span class="line">       email.addTo(<span class="string">"17512080612@163.com"</span>);</span><br><span class="line">       <span class="comment">//设置这个邮件来源于哪里</span></span><br><span class="line">       email.setFrom(<span class="string">"admin@atguigu.com"</span>);</span><br><span class="line">       <span class="comment">//设置邮件主题</span></span><br><span class="line">       email.setSubject(<span class="string">"哈哈，给你测试 "</span>);</span><br><span class="line">       <span class="comment">//设置邮件内容</span></span><br><span class="line">       email.setMsg(<span class="string">"我能给您发邮件&lt;a href='http://www.atguigu.com'&gt;尚硅谷&lt;/a&gt;"</span>);</span><br><span class="line">       <span class="comment">//邮件发送</span></span><br><span class="line">       email.send();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://shenlibing.github.io/myhexo/myhexo/2019/01/12/帆软报表部署配置_emoss5用户分配角色、角色分配权限/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="shenlibing">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/myhexo/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="小兵兵">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/myhexo/2019/01/12/帆软报表部署配置_emoss5用户分配角色、角色分配权限/" class="post-title-link" itemprop="url">帆软报表部署配置_emoss5用户分配角色、角色分配权限</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2019-01-12 12:58:55" itemprop="dateCreated datePublished" datetime="2019-01-12T12:58:55+08:00">2019-01-12</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-01-22 17:14:35" itemprop="dateModified" datetime="2019-01-22T17:14:35+08:00">2019-01-22</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/myhexo/categories/日常记录/" itemprop="url" rel="index"><span itemprop="name">日常记录</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          
            <span id="/myhexo/2019/01/12/帆软报表部署配置_emoss5用户分配角色、角色分配权限/" class="leancloud_visitors" data-flag-title="帆软报表部署配置_emoss5用户分配角色、角色分配权限">
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              
                <span class="post-meta-item-text">阅读次数：</span>
              
                <span class="leancloud-visitors-count"></span>
            </span>
          

          

          
            <div class="post-symbolscount">
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">本文字数：</span>
                
                <span title="本文字数">654</span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">1 分钟</span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>1、帆软报表部署</p>
<p>客户端工具sftp下载链接</p>
<p><a href="https://www.netsarang.com/download/down_form.html?code=623" target="_blank" rel="noopener">https://www.netsarang.com/download/down_form.html?code=623</a></p>
<p>使用sftp</p>
<p><a href="https://www.netsarang.com/download/down_xfp6.html?token=dEFiMWxoUEhuNU1hQlMrRG9qU20yZ0Bnc1hKVGJhaHpkY3hBUUNMNFBoaXVn" target="_blank" rel="noopener">https://www.netsarang.com/download/down_xfp6.html?token=dEFiMWxoUEhuNU1hQlMrRG9qU20yZ0Bnc1hKVGJhaHpkY3hBUUNMNFBoaXVn</a></p>
<p>1）用客户端工具sftp登录到135.125.60.122机子</p>
<p>文件–新建</p>
<p><img src="https://i.imgur.com/2BmJwbi.png" alt=""></p>
<p><img src="https://i.imgur.com/v4wyabN.png" alt=""></p>
<p>报表存放路径</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">/opt/FineBI/webapps/WebReport/WEB-INF/reportlets</span><br></pre></td></tr></table></figure>
<p>2）菜单配置</p>
<p>基础应用–权限模型–菜单管理</p>
<p><img src="https://i.imgur.com/wIRwxey.png" alt=""></p>
<p>建立菜单层级关系</p>
<p>在资源评价菜单下-建立杜邦报表分析文件夹–建立2018杜邦报表3层目录结构</p>
<p>在2018杜邦报表(1)下配置报表位置引用–填写<strong>菜单编码(表名)、排序号、菜单名称(表名中文描述)、菜单URL</strong></p>
<p><img src="https://i.imgur.com/OpkMozW.png" alt=""></p>
<p>菜单URL的配置</p>
<p><img src="https://i.imgur.com/sWq1soL.png" alt=""></p>
<p><img src="https://i.imgur.com/dFluLNT.png" alt=""></p>
<p>2、建员工、建用户、为用户分配角色、为角色分配权限</p>
<p>1）建员工–基础应用–权限模型–员工管理</p>
<p><img src="https://i.imgur.com/3Dy5jZ7.png" alt=""></p>
<p>2）建用户–基础应用–权限模型–用户管理–新增</p>
<p><img src="https://i.imgur.com/P72nX6J.png" alt=""></p>
<p><img src="https://i.imgur.com/m5MJU1X.png" alt=""></p>
<p><strong>新建用户之前必须先建员工、角色、部门，在建用户的时候可以为该用户分配角色和菜单权限</strong></p>
<p><img src="https://i.imgur.com/foNIVta.png" alt=""></p>
<p>3）为用户分配角色–基础应用–权限模型–角色用户设置</p>
<p><img src="https://i.imgur.com/aXEslSF.png" alt=""></p>
<p>先选中角色，然后为该角色添加用户</p>
<p><img src="https://i.imgur.com/OTsxbsS.png" alt=""></p>
<p>4）为角色分配权限–基础应用–权限模型–角色管理</p>
<p><img src="https://i.imgur.com/DzlEsPW.png" alt=""></p>
<p>先选中角色，然后为该角色勾选拥有的菜单权限</p>
<p><img src="https://i.imgur.com/ssEptko.png" alt=""></p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://shenlibing.github.io/myhexo/myhexo/2019/01/11/二维矩阵显示账户类型和资质_ajax异步传参_插入mysql中文乱码/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="shenlibing">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/myhexo/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="小兵兵">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/myhexo/2019/01/11/二维矩阵显示账户类型和资质_ajax异步传参_插入mysql中文乱码/" class="post-title-link" itemprop="url">二维矩阵显示账户类型和资质_ajax异步传参_插入mysql中文乱码</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2019-01-11 12:58:55" itemprop="dateCreated datePublished" datetime="2019-01-11T12:58:55+08:00">2019-01-11</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-01-22 17:35:52" itemprop="dateModified" datetime="2019-01-22T17:35:52+08:00">2019-01-22</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/myhexo/categories/日常记录/" itemprop="url" rel="index"><span itemprop="name">日常记录</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          
            <span id="/myhexo/2019/01/11/二维矩阵显示账户类型和资质_ajax异步传参_插入mysql中文乱码/" class="leancloud_visitors" data-flag-title="二维矩阵显示账户类型和资质_ajax异步传参_插入mysql中文乱码">
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              
                <span class="post-meta-item-text">阅读次数：</span>
              
                <span class="leancloud-visitors-count"></span>
            </span>
          

          

          
            <div class="post-symbolscount">
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">本文字数：</span>
                
                <span title="本文字数">8.8k</span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">8 分钟</span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>1、二维矩阵显示账号类型和资质</p>
<p>效果：</p>
<p><img src="https://i.imgur.com/H6MtJqE.png" alt=""></p>
<p>表结构：</p>
<p>账号类型和资质中间表</p>
<p><img src="https://i.imgur.com/JrwRXlC.png" alt=""></p>
<p>资质表</p>
<p><img src="https://i.imgur.com/dqgX6f3.png" alt=""></p>
<p>思路：</p>
<p>业务层查出账户和资质中间表、资质表、账户表数据，前端展示图横轴根据账户数据填充，纵轴根据资质数据填充，选择框的确定–根据<strong>账户资质中间表数据</strong>和选择框上<strong>自定义属性绑定的账户名、资质id</strong>进行相等比较确定。</p>
<p>前端：</p>
<p>1）单选框勾选关系初始化</p>
<p><img src="https://i.imgur.com/TgzMKiS.png" alt=""></p>
<p>2）异步传参(封装成实体)</p>
<p>实体对象必须有get和set方法</p>
<p><img src="https://i.imgur.com/Frl8lPj.png" alt=""></p>
<p><img src="https://i.imgur.com/5r8EtpQ.png" alt=""></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">	<span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">%</span></span></span><br><span class="line"><span class="tag">	    //设置导航条上的显示</span></span><br><span class="line"><span class="tag">				<span class="attr">pageContext.setAttribute</span>("<span class="attr">navinfo</span>", "分类管理");</span></span><br><span class="line"><span class="tag">				//设置点击高亮效果</span></span><br><span class="line"><span class="tag">				<span class="attr">pageContext.setAttribute</span>("<span class="attr">curUrl</span>", "<span class="attr">servicectrl</span>/<span class="attr">type</span>/<span class="attr">ctrl</span>");</span></span><br><span class="line"><span class="tag">	%&gt;</span></span><br><span class="line">	<span class="comment">&lt;!--引入导航条  --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">%@include</span> <span class="attr">file</span>=<span class="string">"/WEB-INF/includes/nav-bar.jsp"</span>%&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"container-fluid"</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"row"</span>&gt;</span></span><br><span class="line">			<span class="comment">&lt;!--引入树形菜单  --&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">%@include</span> <span class="attr">file</span>=<span class="string">"/WEB-INF/includes/user_menu.jsp"</span>%&gt;</span></span><br><span class="line"></span><br><span class="line">			<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"col-sm-9 col-sm-offset-3 col-md-10 col-md-offset-2 main"</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"panel panel-default"</span>&gt;</span></span><br><span class="line">					<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"panel-heading"</span>&gt;</span></span><br><span class="line">						<span class="tag">&lt;<span class="name">h3</span> <span class="attr">class</span>=<span class="string">"panel-title"</span>&gt;</span></span><br><span class="line">							<span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">"glyphicon glyphicon-th"</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span> 数据矩阵</span><br><span class="line">						<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">					<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">					<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"panel-body"</span>&gt;</span></span><br><span class="line">						<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"table-responsive"</span>&gt;</span></span><br><span class="line">							<span class="tag">&lt;<span class="name">table</span> <span class="attr">class</span>=<span class="string">"table  table-bordered"</span>&gt;</span></span><br><span class="line">								<span class="tag">&lt;<span class="name">thead</span>&gt;</span></span><br><span class="line">									<span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">										<span class="tag">&lt;<span class="name">th</span>&gt;</span>名称<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">										<span class="tag">&lt;<span class="name">c:forEach</span> <span class="attr">items</span>=<span class="string">"$&#123;types&#125;"</span> <span class="attr">var</span>=<span class="string">"type"</span>&gt;</span></span><br><span class="line">											<span class="tag">&lt;<span class="name">th</span>&gt;</span>$&#123;type&#125;<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">										<span class="tag">&lt;/<span class="name">c:forEach</span>&gt;</span></span><br><span class="line">									<span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">								<span class="tag">&lt;/<span class="name">thead</span>&gt;</span></span><br><span class="line">								<span class="tag">&lt;<span class="name">tbody</span>&gt;</span></span><br><span class="line">									<span class="tag">&lt;<span class="name">c:forEach</span> <span class="attr">items</span>=<span class="string">"$&#123;certs&#125;"</span> <span class="attr">var</span>=<span class="string">"cert"</span>&gt;</span></span><br><span class="line">										<span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">											<span class="tag">&lt;<span class="name">td</span>&gt;</span>$&#123;cert.name&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">											<span class="tag">&lt;<span class="name">c:forEach</span> <span class="attr">items</span>=<span class="string">"$&#123;types&#125;"</span> <span class="attr">var</span>=<span class="string">"type"</span>&gt;</span></span><br><span class="line">												<span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">class</span>=<span class="string">'checkSimple'</span> <span class="attr">type</span>=<span class="string">"checkbox"</span></span></span><br><span class="line"><span class="tag">													<span class="attr">type_name</span>=<span class="string">'$&#123;type&#125;'</span> <span class="attr">cid</span>=<span class="string">'$&#123;cert.id&#125;'</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">											<span class="tag">&lt;/<span class="name">c:forEach</span>&gt;</span></span><br><span class="line">									<span class="tag">&lt;/<span class="name">c:forEach</span>&gt;</span></span><br><span class="line">									<span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">								<span class="tag">&lt;/<span class="name">tbody</span>&gt;</span></span><br><span class="line">							<span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line">						<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">					<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">%@include</span> <span class="attr">file</span>=<span class="string">"/WEB-INF/includes/js-file.jsp"</span>%&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- 引入树形菜单结构点击时动态显示页面高亮效果的js --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">%@include</span> <span class="attr">file</span>=<span class="string">"/WEB-INF/includes/common-js.jsp"</span>%&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript">		$(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">			$(<span class="string">".list-group-item"</span>).click(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">				<span class="keyword">if</span> ($(<span class="keyword">this</span>).find(<span class="string">"ul"</span>)) &#123;</span></span><br><span class="line"><span class="javascript">					$(<span class="keyword">this</span>).toggleClass(<span class="string">"tree-closed"</span>);</span></span><br><span class="line"><span class="javascript">					<span class="keyword">if</span> ($(<span class="keyword">this</span>).hasClass(<span class="string">"tree-closed"</span>)) &#123;</span></span><br><span class="line"><span class="javascript">						$(<span class="string">"ul"</span>, <span class="keyword">this</span>).hide(<span class="string">"fast"</span>);</span></span><br><span class="line"><span class="javascript">					&#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="javascript">						$(<span class="string">"ul"</span>, <span class="keyword">this</span>).show(<span class="string">"fast"</span>);</span></span><br><span class="line"><span class="undefined">					&#125;</span></span><br><span class="line"><span class="undefined">				&#125;</span></span><br><span class="line"><span class="undefined">			&#125;)</span></span><br><span class="line"><span class="undefined">		&#125;)</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">		$(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">			<span class="comment">//页面加载完成获取账户类型和资质的关系</span></span></span><br><span class="line"><span class="javascript">			<span class="keyword">var</span> list_type_cert = <span class="string">'$&#123;list_type_cert_json&#125;'</span></span></span><br><span class="line"><span class="javascript">			log(<span class="string">'list_type_cert'</span>, list_type_cert)</span></span><br><span class="line"><span class="javascript">			<span class="comment">//string</span></span></span><br><span class="line"><span class="javascript">			log(<span class="string">'list_type_cert type=======&gt;'</span>, <span class="keyword">typeof</span> (list_type_cert))</span></span><br><span class="line"><span class="javascript">			<span class="comment">//JSON.parse(list_type_cert) 字符串转成json对象</span></span></span><br><span class="line"><span class="javascript">			$.each(<span class="built_in">JSON</span>.parse(list_type_cert),<span class="function"><span class="keyword">function</span>(<span class="params">index, content</span>) </span>&#123;</span></span><br><span class="line"><span class="undefined">				log(index, content, content.accttype,content.certid)</span></span><br><span class="line"><span class="javascript">				$(<span class="string">'.checkSimple'</span>).each(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">					<span class="comment">//attr获取自定义属性值</span></span></span><br><span class="line"><span class="javascript">					<span class="keyword">if</span> ($(<span class="keyword">this</span>).attr(<span class="string">'type_name'</span>) == (content.accttype)&amp;&amp; $(<span class="keyword">this</span>).attr(<span class="string">'cid'</span>) == (content.certid)) &#123;</span></span><br><span class="line"><span class="javascript">						<span class="comment">//设置原生属性值</span></span></span><br><span class="line"><span class="javascript">						$(<span class="keyword">this</span>).prop(<span class="string">'checked'</span>,<span class="literal">true</span>)</span></span><br><span class="line"><span class="undefined">					&#125;</span></span><br><span class="line"><span class="undefined">			&#125;)</span></span><br><span class="line"><span class="undefined">		&#125;)</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">			<span class="comment">//执行事件</span></span></span><br><span class="line"><span class="undefined">			__main()</span></span><br><span class="line"><span class="undefined">		&#125;)</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">		<span class="comment">//更新</span></span></span><br><span class="line"><span class="javascript">		<span class="keyword">var</span> update_type_cert_event = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">			<span class="keyword">var</span> tAccountTypeCert = &#123;&#125;</span></span><br><span class="line"><span class="javascript">			log(<span class="string">'update_type_cert_event=============&gt;'</span>)</span></span><br><span class="line"><span class="javascript">			$(<span class="string">'body'</span>).on(<span class="string">'click'</span>, <span class="string">'input'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">				log(<span class="string">'update==========&gt;'</span>, <span class="keyword">this</span>)</span></span><br><span class="line"><span class="javascript">				<span class="keyword">var</span> flag = $(<span class="keyword">this</span>).prop(<span class="string">'checked'</span>)</span></span><br><span class="line"><span class="javascript">				log(<span class="string">'flag==========&gt;'</span>, flag)</span></span><br><span class="line"><span class="javascript">				accttype = $(<span class="keyword">this</span>).attr(<span class="string">'type_name'</span>)</span></span><br><span class="line"><span class="javascript">				certid = $(<span class="keyword">this</span>).attr(<span class="string">'cid'</span>)</span></span><br><span class="line"><span class="undefined">				log(accttype, certid)</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="undefined">				tAccountTypeCert.accttype = accttype</span></span><br><span class="line"><span class="undefined">				tAccountTypeCert.certid = certid</span></span><br><span class="line"><span class="undefined">				tAccountTypeCert.flag = flag</span></span><br><span class="line"><span class="javascript">				<span class="keyword">var</span> url = <span class="string">'$&#123;ctp&#125;/servicectrl/type/update_type_cert'</span></span></span><br><span class="line"><span class="javascript">				<span class="keyword">var</span> data = tAccountTypeCert</span></span><br><span class="line"><span class="javascript">				$.getJSON(url, data, <span class="function"><span class="keyword">function</span>(<span class="params">result</span>) </span>&#123;</span></span><br><span class="line"><span class="undefined">					log(result)</span></span><br><span class="line"><span class="undefined">				&#125;)</span></span><br><span class="line"><span class="undefined">			&#125;)</span></span><br><span class="line"><span class="undefined">		&#125;</span></span><br><span class="line"><span class="javascript">		<span class="keyword">var</span> __main = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="undefined">			update_type_cert_event()</span></span><br><span class="line"><span class="undefined">		&#125;</span></span><br><span class="line"><span class="undefined">	</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>控制层：</p>
<p>1)接收异步传参实体返回json</p>
<p><img src="https://i.imgur.com/7Pcl0Tu.png" alt=""></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">package</span> com.atguigu.scw.manager.controller.manager;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.ui.Model;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestParam;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.ResponseBody;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.atguigu.scw.manager.bean.TAccountTypeCert;</span><br><span class="line"><span class="keyword">import</span> com.atguigu.scw.manager.bean.TCert;</span><br><span class="line"><span class="keyword">import</span> com.atguigu.scw.manager.service.CertService;</span><br><span class="line"><span class="keyword">import</span> com.atguigu.scw.manager.service.CertTypeService;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.ObjectMapper;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/servicectrl/type"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TypeController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    CertService certService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    CertTypeService cTypeService;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> ObjectMapper MAPPER = <span class="keyword">new</span> ObjectMapper();</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"/ctrl"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">list</span><span class="params">(Model model)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"分类管理界面============&gt;"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 1、先去数据库查出表格横向的显示数据</span></span><br><span class="line">        List&lt;String&gt; types = Arrays.asList(<span class="string">"商业公司"</span>, <span class="string">"个体工商户"</span>, <span class="string">"个人经营"</span>, <span class="string">"政府及非营利组织"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2、在查出纵向要显示的标题</span></span><br><span class="line">        List&lt;TCert&gt; certs = certService.getAllCert();</span><br><span class="line">        System.out.println(<span class="string">"资质===========&gt;"</span>);</span><br><span class="line">        System.out.println(certs);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3、查询经营类型与资质关系中间表</span></span><br><span class="line">        <span class="comment">// List&lt;TAccountTypeCert&gt; cTypeService.getAllCertType();</span></span><br><span class="line">        List&lt;TAccountTypeCert&gt; list_type_cert = cTypeService.getAllCertType();</span><br><span class="line">        System.out.println(<span class="string">"经营类型===============&gt;"</span>);</span><br><span class="line">        System.out.println(list_type_cert);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 4、将数据放到模型域当中</span></span><br><span class="line">        model.addAttribute(<span class="string">"types"</span>, types);</span><br><span class="line">        model.addAttribute(<span class="string">"certs"</span>, certs);</span><br><span class="line">        <span class="comment">// list转json字符串</span></span><br><span class="line">        String list_type_cert_json = MAPPER.writeValueAsString(list_type_cert);</span><br><span class="line">        System.out.println(<span class="string">"经营类型--资质----"</span>);</span><br><span class="line">        System.out.println(list_type_cert_json);</span><br><span class="line">        model.addAttribute(<span class="string">"list_type_cert_json"</span>, list_type_cert_json);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="string">"manager/servicemanager/type"</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"/update_type_cert"</span>)</span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">update_type_cert</span><span class="params">(TAccountTypeCert tAccountTypeCert)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"更新经营类型---资质==========&gt;"</span>);</span><br><span class="line">        System.out.println(tAccountTypeCert);</span><br><span class="line">        <span class="keyword">boolean</span> flag = tAccountTypeCert.isFlag();</span><br><span class="line">        System.out.println(<span class="string">"flag============&gt;"</span>);</span><br><span class="line">        System.out.println(flag);</span><br><span class="line">        <span class="keyword">if</span> (flag) &#123;</span><br><span class="line">            System.out.println(<span class="string">"增加一条记录========&gt;"</span>);</span><br><span class="line">            <span class="keyword">int</span> count = cTypeService.updateTypeCert(tAccountTypeCert);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">"移除一条记录========&gt;"</span>);</span><br><span class="line">            cTypeService.removeTypeCert(tAccountTypeCert);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="string">"success"</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>业务层：</p>
<p>1）单表的写读操作</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">package</span> com.atguigu.scw.manager.service.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.atguigu.scw.manager.bean.TAccountTypeCert;</span><br><span class="line"><span class="keyword">import</span> com.atguigu.scw.manager.bean.TAccountTypeCertExample;</span><br><span class="line"><span class="keyword">import</span> com.atguigu.scw.manager.bean.TAccountTypeCertExample.Criteria;</span><br><span class="line"><span class="keyword">import</span> com.atguigu.scw.manager.dao.TAccountTypeCertMapper;</span><br><span class="line"><span class="keyword">import</span> com.atguigu.scw.manager.service.CertTypeService;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CertTypeServiceImpl</span> <span class="keyword">implements</span> <span class="title">CertTypeService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    TAccountTypeCertMapper mapper;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//查询资质和账户中间表</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;TAccountTypeCert&gt; <span class="title">getAllCertType</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        List&lt;TAccountTypeCert&gt; list_type_cert = mapper.selectByExample(<span class="keyword">null</span>);</span><br><span class="line">        <span class="keyword">return</span> list_type_cert;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 增加经营类型--资质</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">updateTypeCert</span><span class="params">(TAccountTypeCert tAccountTypeCert)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> count = mapper.insertSelective(tAccountTypeCert);</span><br><span class="line">        <span class="keyword">return</span> count;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 删除经营类型--资质</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">removeTypeCert</span><span class="params">(TAccountTypeCert tAccountTypeCert)</span> </span>&#123;</span><br><span class="line">        TAccountTypeCertExample example = <span class="keyword">new</span> TAccountTypeCertExample();</span><br><span class="line">        Criteria criteria = example.createCriteria();</span><br><span class="line">        criteria.andAccttypeEqualTo(tAccountTypeCert.getAccttype());</span><br><span class="line">        criteria.andCertidEqualTo(tAccountTypeCert.getCertid());</span><br><span class="line">        <span class="keyword">int</span> count = mapper.deleteByExample(example);</span><br><span class="line">        <span class="keyword">return</span> count;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>2、mysql插入中文乱码</p>
<p>1）数据库编码和web.xml配置均为utf-8，Controller读取到的是正确的中文，但是保存到数据库后变成”??”</p>
<p>解决</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"url"</span> <span class="attr">value</span>=<span class="string">"jdbc:mysql://localhost:3306/scw_0325?useUnicode=true&amp;amp;characterEncoding=UTF-8"</span> &gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><img src="https://i.imgur.com/SYguSUW.png" alt=""></p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://shenlibing.github.io/myhexo/myhexo/2019/01/10/ztree树形结构菜单_mybatis分页查询/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="shenlibing">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/myhexo/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="小兵兵">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/myhexo/2019/01/10/ztree树形结构菜单_mybatis分页查询/" class="post-title-link" itemprop="url">ztree树形结构菜单_mybatis分页查询</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2019-01-10 12:58:55" itemprop="dateCreated datePublished" datetime="2019-01-10T12:58:55+08:00">2019-01-10</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-01-22 17:36:06" itemprop="dateModified" datetime="2019-01-22T17:36:06+08:00">2019-01-22</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/myhexo/categories/日常记录/" itemprop="url" rel="index"><span itemprop="name">日常记录</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          
            <span id="/myhexo/2019/01/10/ztree树形结构菜单_mybatis分页查询/" class="leancloud_visitors" data-flag-title="ztree树形结构菜单_mybatis分页查询">
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              
                <span class="post-meta-item-text">阅读次数：</span>
              
                <span class="leancloud-visitors-count"></span>
            </span>
          

          

          
            <div class="post-symbolscount">
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">本文字数：</span>
                
                <span title="本文字数">15k</span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">13 分钟</span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>1、二级树形菜单</p>
<p>效果图</p>
<p><img src="https://i.imgur.com/xC5UACi.png" alt=""></p>
<p>表结构<br><img src="https://i.imgur.com/yNutkpm.png" alt=""></p>
<p>业务层：</p>
<p>二级菜单实现思路：</p>
<p>1）查出父菜单（pid=0），通过遍历父菜单获得父菜单(id)，根据父菜单id值作为条件查出子菜单（子菜单pid=父菜单id），接着整理父子菜单关系；这种不推荐，假如所有菜单为18个，查出父菜单3个封装到集合时需要遍历18次，根据父菜单id作为查询子菜单的条件需要遍历3*18次。</p>
<p>2）一次性查出所有菜单18个，使用程序进行组合，这种推荐，以空间换时间。</p>
<p>封装菜单实体</p>
<p><img src="https://i.imgur.com/bNHeGw9.png" alt=""></p>
<p>业务层：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> List&lt;TPermission&gt; <span class="title">getAllMenus</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 保存父菜单</span></span><br><span class="line">    List&lt;TPermission&gt; menus = <span class="keyword">new</span> ArrayList&lt;TPermission&gt;();</span><br><span class="line">    Map&lt;Integer, TPermission&gt; map = <span class="keyword">new</span> HashMap&lt;Integer, TPermission&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 查询所有菜单</span></span><br><span class="line">    <span class="comment">// 参数为null，表示不带条件查询菜单</span></span><br><span class="line">    List&lt;TPermission&gt; list = mapper.selectByExample(<span class="keyword">null</span>);</span><br><span class="line">    System.out.println(<span class="string">"所有菜单=========&gt;"</span>);</span><br><span class="line">    System.out.println(list);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 1、将所有菜单都放在map中</span></span><br><span class="line">    <span class="comment">// 都是引用，如果从map中拿到这个数据改变以后，map中页面变化</span></span><br><span class="line">    <span class="keyword">for</span> (TPermission tPermission : list) &#123;</span><br><span class="line">        map.put(tPermission.getId(), tPermission);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2、先封装父菜单，再将子菜单放入到父菜单中</span></span><br><span class="line">    <span class="keyword">for</span> (TPermission tPermission : list) &#123;</span><br><span class="line">        <span class="keyword">if</span> (tPermission.getPid() == <span class="number">0</span>) &#123;</span><br><span class="line">            menus.add(tPermission);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// tPermission（子菜单），拿到父菜单</span></span><br><span class="line">            Integer pid = tPermission.getPid();</span><br><span class="line">            <span class="comment">// 拿到父菜单；以pid的值作为map中的菜单id，就是父菜单</span></span><br><span class="line">            TPermission p_menu = map.get(pid);</span><br><span class="line">            <span class="comment">// 拿到当前父菜单的子菜单；子菜单会有一些额外的问题</span></span><br><span class="line">            <span class="comment">// 这个list第一次获取是没有的，如果添加上一次以后。这个list是有的</span></span><br><span class="line">            List&lt;TPermission&gt; childs = p_menu.getChilds();</span><br><span class="line">            <span class="keyword">if</span> (childs != <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="comment">// 当前有子菜单</span></span><br><span class="line">                childs.add(tPermission);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="comment">// 当前没有子菜单</span></span><br><span class="line">                childs = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">                <span class="comment">// 添加当前子菜单</span></span><br><span class="line">                childs.add(tPermission);</span><br><span class="line">                <span class="comment">// 将当前整理好的childs设置进去</span></span><br><span class="line">                p_menu.setChilds(childs);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    System.out.println(<span class="string">"父菜单===========&gt;"</span>);</span><br><span class="line">    System.out.println(menus);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> menus;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>控制层</p>
<p>1）将整理好的父子菜单数据放入到session域中，当前用户的这次会话一直使用，只需要去数据库查询一次</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">@RequestMapping</span>(value = <span class="string">"/main.html"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">toMainPage</span><span class="params">(HttpSession session)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 校验</span></span><br><span class="line">    <span class="comment">// 判断session中是否有这个用户，如果没有去登陆页面</span></span><br><span class="line">    Object object = session.getAttribute(Constants.LOGIN_USER);</span><br><span class="line">    <span class="keyword">if</span> (object == <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="comment">// 用户没登陆</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">"redirect:/login.jsp"</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// 用户登陆才来到主页，session中没有菜单，或者菜单被我们从session中清除了</span></span><br><span class="line">        <span class="keyword">if</span> (session.getAttribute(Constants.USER_MENUS) == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="comment">// 1、查出所有菜单，在页面进行显示</span></span><br><span class="line">            List&lt;TPermission&gt; menus = ps.getAllMenus();</span><br><span class="line">            <span class="comment">// 2、将查到的菜单放在session域中</span></span><br><span class="line">            <span class="comment">// 菜单这些数据没必要每次来到主页，都调用service方法进行查询；放在session用户，</span></span><br><span class="line">            <span class="comment">// 当前用户的这次会话一直使用，只需要去数据库查一次</span></span><br><span class="line">            session.setAttribute(Constants.USER_MENUS, menus);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="string">"manager/main"</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>前台：</p>
<p>1）引入：&lt;%@ taglib prefix=”fn” uri=”<a href="http://java.sun.com/jsp/jstl/functions&quot;%&gt;" target="_blank" rel="noopener">http://java.sun.com/jsp/jstl/functions&quot;%&gt;</a><br>计算后台传过来的list集合的长度：${fn:length(p_menu.childs)}</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">%@</span> <span class="attr">page</span> <span class="attr">language</span>=<span class="string">"java"</span> <span class="attr">contentType</span>=<span class="string">"text/html; charset=UTF-8"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">pageEncoding</span>=<span class="string">"UTF-8"</span>%&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">%@taglib</span> <span class="attr">uri</span>=<span class="string">"http://java.sun.com/jsp/jstl/core"</span> <span class="attr">prefix</span>=<span class="string">"c"</span>%&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">%@</span> <span class="attr">taglib</span> <span class="attr">prefix</span>=<span class="string">"fn"</span> <span class="attr">uri</span>=<span class="string">"http://java.sun.com/jsp/jstl/functions"</span>%&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"col-sm-3 col-md-2 sidebar"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"tree"</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">ul</span> <span class="attr">style</span>=<span class="string">"padding-left: 0px;"</span> <span class="attr">class</span>=<span class="string">"list-group"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">			<span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"list-group-item tree-closed"</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"main.html"</span>&gt;</span><span class="tag">&lt;<span class="name">i</span></span></span><br><span class="line"><span class="tag">					<span class="attr">class</span>=<span class="string">"glyphicon glyphicon-dashboard"</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span> 控制面板<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">			<span class="comment">&lt;!-- 遍历父菜单 --&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">c:forEach</span> <span class="attr">items</span>=<span class="string">"$&#123;sessionScope.userMenus&#125;"</span> <span class="attr">var</span>=<span class="string">"p_menu"</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"list-group-item tree-closed"</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">i</span></span></span><br><span class="line"><span class="tag">						<span class="attr">class</span>=<span class="string">"$&#123;p_menu.icon&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span>$&#123;p_menu.name&#125; <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"badge"</span></span></span><br><span class="line"><span class="tag">						<span class="attr">style</span>=<span class="string">"float: right"</span>&gt;</span>$&#123;fn:length(p_menu.childs)&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">					<span class="tag">&lt;<span class="name">ul</span> <span class="attr">style</span>=<span class="string">"margin-top: 10px; display: none;"</span>&gt;</span></span><br><span class="line">						<span class="comment">&lt;!-- 遍历子菜单 --&gt;</span></span><br><span class="line">						<span class="tag">&lt;<span class="name">c:forEach</span> <span class="attr">items</span>=<span class="string">"$&#123;p_menu.childs&#125;"</span> <span class="attr">var</span>=<span class="string">"c_menu"</span>&gt;</span></span><br><span class="line">							<span class="tag">&lt;<span class="name">li</span> <span class="attr">style</span>=<span class="string">"height: 30px;"</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"$&#123;ctp&#125;/$&#123;c_menu.url&#125;"</span> <span class="attr">data-action</span>=<span class="string">"$&#123;c_menu.id&#125;"</span>&gt;</span><span class="tag">&lt;<span class="name">i</span></span></span><br><span class="line"><span class="tag">									<span class="attr">class</span>=<span class="string">"$&#123;c_menu.icon&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span>$&#123;c_menu.name&#125;<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">						<span class="tag">&lt;/<span class="name">c:forEach</span>&gt;</span></span><br><span class="line">					<span class="tag">&lt;/<span class="name">ul</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;/<span class="name">c:forEach</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>2、mybatis分页查询</p>
<p>根据用户名或者账号进行查询</p>
<p>效果图：</p>
<p><img src="https://i.imgur.com/uATdmaF.png" alt=""></p>
<p>引入依赖：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 分页 插件 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.github.pagehelper<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>pagehelper<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>业务层：</p>
<p>1）带条件查询</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> List&lt;TUser&gt; <span class="title">getAllUsersByCondition</span><span class="params">(String str)</span> </span>&#123;</span><br><span class="line">    System.out.println(<span class="string">"UserServiceImpl.getAllUsersByCondition 带条件查询员工============&gt;"</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 查询条件拼接</span></span><br><span class="line">    <span class="comment">// 第一次创建的条件，默认使用and连接的</span></span><br><span class="line">    TUserExample tUserExample = <span class="keyword">new</span> TUserExample();</span><br><span class="line">    Criteria criteria = tUserExample.createCriteria();</span><br><span class="line">    Criteria criteria2 = tUserExample.createCriteria();</span><br><span class="line">    <span class="keyword">if</span> (!str.trim().equals(<span class="string">""</span>)) &#123;</span><br><span class="line">        criteria.andLoginacctLike(<span class="string">"%"</span> + str + <span class="string">"%"</span>);</span><br><span class="line">        criteria.andUsernameLike(<span class="string">"%"</span> + str + <span class="string">"%"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    tUserExample.or(criteria2);</span><br><span class="line">    List&lt;TUser&gt; list_users_example = userMapper.selectByExample(tUserExample);</span><br><span class="line">    <span class="keyword">return</span> list_users_example;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>控制层：</p>
<p>1）mybatis分页插件会对结果集进行包装，必须在查询前设置： PageHelper.startPage(pn, ps);</p>
<p>2）查询后输入框数据回显：model.addAttribute(“sp”, search);（转发）</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/list"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">users</span><span class="params">(@RequestParam(value = <span class="string">"pn"</span>, defaultValue = <span class="string">"1"</span>)</span> Integer pn,</span></span><br><span class="line"><span class="function">        @<span class="title">RequestParam</span><span class="params">(value = <span class="string">"ps"</span>, defaultValue = <span class="string">"5"</span>)</span> Integer ps,</span></span><br><span class="line"><span class="function">        @<span class="title">RequestParam</span><span class="params">(value = <span class="string">"sp"</span>, defaultValue = <span class="string">""</span>)</span> String search, Model model) </span>&#123;</span><br><span class="line">    System.out.println(<span class="string">"UserController.users 用户列表显示页===========&gt;"</span>);</span><br><span class="line"></span><br><span class="line">    System.out.println(<span class="string">"前台请求参数[第xxx页，每页显示xxx条数]==========&gt;"</span>);</span><br><span class="line">    System.out.println(pn);</span><br><span class="line">    System.out.println(ps);</span><br><span class="line">    <span class="comment">// 分页显示数据,这里设置必须放到查询数据之前，否则前台会有问题</span></span><br><span class="line">    PageHelper.startPage(pn, ps);</span><br><span class="line"></span><br><span class="line">    List&lt;TUser&gt; list_users = userService.getAllUsersByCondition(search);</span><br><span class="line">    System.out.println(<span class="string">"查询到的所有用户列表========&gt;"</span>);</span><br><span class="line">    System.out.println(list_users);</span><br><span class="line"></span><br><span class="line">    PageInfo&lt;TUser&gt; users = <span class="keyword">new</span> PageInfo&lt;&gt;(list_users, <span class="number">5</span>);</span><br><span class="line">    System.out.println(<span class="string">"分页后的数据处理"</span>);</span><br><span class="line">    System.out.println(users);</span><br><span class="line">    <span class="comment">// 将查询用户列表数据放在请求域中，表单查询参数回显到页面</span></span><br><span class="line">    model.addAttribute(<span class="string">"users"</span>, users);</span><br><span class="line">    model.addAttribute(<span class="string">"sp"</span>, search);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="string">"manager/permission/user"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>前台：</p>
<p>1）为所有分页连接绑定单击事件，让其动态的带上分页的查询参数</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">var</span> href = $(<span class="keyword">this</span>).attr(<span class="string">"href"</span>) + <span class="string">"&amp;sp="</span>+ $(<span class="string">"input[name='sp']"</span>).val()&lt;br/&gt;</span><br><span class="line">$(<span class="keyword">this</span>).attr(<span class="string">"href"</span>, href)</span><br></pre></td></tr></table></figure>
<p>2)全选和全不选函数</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">//全选/全不选函数</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">checkall_reverse</span>(<span class="params">check_all_btn, check_btn</span>) </span>&#123;</span><br><span class="line">	check_all_btn.click(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">		<span class="comment">//如果是原生的属性，使用prop获取比较好</span></span><br><span class="line">		check_btn.prop(<span class="string">"checked"</span>, $(<span class="keyword">this</span>).prop(<span class="string">"checked"</span>))</span><br><span class="line">	&#125;)</span><br><span class="line">	check_btn.click(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">		<span class="comment">//当check_btn点满以后check_all_btn勾上，否则不选中</span></span><br><span class="line">		<span class="comment">//获取被选中的checkbtn个数</span></span><br><span class="line">		<span class="keyword">var</span> flag = check_btn.filter(<span class="string">":checked"</span>).length == check_btn.length</span><br><span class="line">		check_all_btn.prop(<span class="string">"checked"</span>, flag);</span><br><span class="line">	&#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">%@</span> <span class="attr">page</span> <span class="attr">language</span>=<span class="string">"java"</span> <span class="attr">contentType</span>=<span class="string">"text/html; charset=UTF-8"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">pageEncoding</span>=<span class="string">"UTF-8"</span>%&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"X-UA-Compatible"</span> <span class="attr">content</span>=<span class="string">"IE=edge"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=device-width, initial-scale=1"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"description"</span> <span class="attr">content</span>=<span class="string">""</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"author"</span> <span class="attr">content</span>=<span class="string">""</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">%@include</span> <span class="attr">file</span>=<span class="string">"/WEB-INF/includes/css-file.jsp"</span>%&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">href</span>=<span class="string">"$&#123;ctp&#125;/css/main.css"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="undefined">.tree li &#123;</span></span><br><span class="line"><span class="undefined">	list-style-type: none;</span></span><br><span class="line"><span class="undefined">	cursor: pointer;</span></span><br><span class="line"><span class="undefined">&#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="undefined">table tbody tr:nth-child(odd) &#123;</span></span><br><span class="line"><span class="undefined">	background: #F4F4F4;</span></span><br><span class="line"><span class="undefined">&#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="undefined">table tbody td:nth-child(even) &#123;</span></span><br><span class="line"><span class="undefined">	color: #C00;</span></span><br><span class="line"><span class="undefined">&#125;</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="tag">&lt;<span class="name">%</span></span></span><br><span class="line"><span class="tag">	    //设置导航条上的显示</span></span><br><span class="line"><span class="tag">				<span class="attr">pageContext.setAttribute</span>("<span class="attr">navinfo</span>", "用户维护");</span></span><br><span class="line"><span class="tag">				//设置点击高亮效果</span></span><br><span class="line"><span class="tag">				<span class="attr">pageContext.setAttribute</span>("<span class="attr">curUrl</span>", "<span class="attr">permission</span>/<span class="attr">user</span>/<span class="attr">list</span>");</span></span><br><span class="line"><span class="tag">	%&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- 引入navbar--&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">%@include</span> <span class="attr">file</span>=<span class="string">"/WEB-INF/includes/nav-bar.jsp"</span>%&gt;</span><span class="tag">&lt;/<span class="name">nav</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"container-fluid"</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"row"</span>&gt;</span></span><br><span class="line">			<span class="comment">&lt;!-- 引入树形菜单 --&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">%@include</span> <span class="attr">file</span>=<span class="string">"/WEB-INF/includes/user_menu.jsp"</span>%&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"col-sm-9 col-sm-offset-3 col-md-10 col-md-offset-2 main"</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"panel panel-default"</span>&gt;</span></span><br><span class="line">					<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"panel-heading"</span>&gt;</span></span><br><span class="line">						<span class="tag">&lt;<span class="name">h3</span> <span class="attr">class</span>=<span class="string">"panel-title"</span>&gt;</span></span><br><span class="line">							<span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">"glyphicon glyphicon-th"</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span> 数据列表</span><br><span class="line">						<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">					<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">					<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"panel-body"</span>&gt;</span></span><br><span class="line">						<span class="tag">&lt;<span class="name">form</span> <span class="attr">class</span>=<span class="string">"form-inline"</span> <span class="attr">role</span>=<span class="string">"form"</span> <span class="attr">style</span>=<span class="string">"float: left;"</span></span></span><br><span class="line"><span class="tag">							<span class="attr">action</span>=<span class="string">"$&#123;ctp &#125;/permission/user/list"</span> <span class="attr">method</span>=<span class="string">"post"</span>&gt;</span></span><br><span class="line">							<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"form-group has-feedback"</span>&gt;</span></span><br><span class="line">								<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"input-group"</span>&gt;</span></span><br><span class="line">									<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"input-group-addon"</span>&gt;</span>查询条件<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">									<span class="tag">&lt;<span class="name">input</span> <span class="attr">class</span>=<span class="string">"form-control has-success"</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"sp"</span></span></span><br><span class="line"><span class="tag">										<span class="attr">placeholder</span>=<span class="string">"用户名/账号查询"</span> <span class="attr">value</span>=<span class="string">"$&#123;sp&#125;"</span>&gt;</span></span><br><span class="line">								<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">							<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">							<span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">class</span>=<span class="string">"btn btn-warning"</span>&gt;</span></span><br><span class="line">								<span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">"glyphicon glyphicon-search"</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span> 查询</span><br><span class="line">							<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">						<span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">						<span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">class</span>=<span class="string">"btn btn-danger"</span></span></span><br><span class="line"><span class="tag">							<span class="attr">style</span>=<span class="string">"float: right; margin-left: 10px;"</span>&gt;</span></span><br><span class="line">							<span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">" glyphicon glyphicon-remove"</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span> 删除</span><br><span class="line">						<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">						<span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">class</span>=<span class="string">"btn btn-primary"</span></span></span><br><span class="line"><span class="tag">							<span class="attr">style</span>=<span class="string">"float: right;"</span> <span class="attr">onclick</span>=<span class="string">"window.location.href='add.html'"</span>&gt;</span></span><br><span class="line">							<span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">"glyphicon glyphicon-plus"</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span> 新增</span><br><span class="line">						<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">						<span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">						<span class="tag">&lt;<span class="name">hr</span> <span class="attr">style</span>=<span class="string">"clear: both;"</span>&gt;</span></span><br><span class="line">						<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"table-responsive"</span>&gt;</span></span><br><span class="line">							<span class="tag">&lt;<span class="name">table</span> <span class="attr">class</span>=<span class="string">"table  table-bordered"</span>&gt;</span></span><br><span class="line">								<span class="tag">&lt;<span class="name">thead</span>&gt;</span></span><br><span class="line">									<span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">										<span class="tag">&lt;<span class="name">th</span> <span class="attr">width</span>=<span class="string">"30"</span>&gt;</span>#<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">										<span class="tag">&lt;<span class="name">th</span> <span class="attr">width</span>=<span class="string">"30"</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"checkbox"</span> <span class="attr">id</span>=<span class="string">"checkall_btn"</span>&gt;</span><span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">										<span class="tag">&lt;<span class="name">th</span>&gt;</span>账号<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">										<span class="tag">&lt;<span class="name">th</span>&gt;</span>名称<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">										<span class="tag">&lt;<span class="name">th</span>&gt;</span>邮箱地址<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">										<span class="tag">&lt;<span class="name">th</span> <span class="attr">width</span>=<span class="string">"100"</span>&gt;</span>操作<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">									<span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">								<span class="tag">&lt;/<span class="name">thead</span>&gt;</span></span><br><span class="line">								<span class="tag">&lt;<span class="name">tbody</span>&gt;</span></span><br><span class="line">									<span class="tag">&lt;<span class="name">c:forEach</span> <span class="attr">items</span>=<span class="string">"$&#123;users.list&#125;"</span> <span class="attr">var</span>=<span class="string">"user"</span>&gt;</span></span><br><span class="line">										<span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">											<span class="tag">&lt;<span class="name">td</span>&gt;</span>$&#123;user.id&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">											<span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"checkbox"</span> <span class="attr">class</span>=<span class="string">"single_check"</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">											<span class="tag">&lt;<span class="name">td</span>&gt;</span>$&#123;user.loginacct &#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">											<span class="tag">&lt;<span class="name">td</span>&gt;</span>$&#123;user.username &#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">											<span class="tag">&lt;<span class="name">td</span>&gt;</span>$&#123;user.email &#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">											<span class="tag">&lt;<span class="name">td</span>&gt;</span></span><br><span class="line">												<span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">class</span>=<span class="string">"btn btn-success btn-xs"</span>&gt;</span></span><br><span class="line">													<span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">" glyphicon glyphicon-check"</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">												<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">												<span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">class</span>=<span class="string">"btn btn-primary btn-xs"</span>&gt;</span></span><br><span class="line">													<span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">" glyphicon glyphicon-pencil"</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">												<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">												<span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">class</span>=<span class="string">"btn btn-danger btn-xs"</span>&gt;</span></span><br><span class="line">													<span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">" glyphicon glyphicon-remove"</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">												<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">											<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">										<span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">									<span class="tag">&lt;/<span class="name">c:forEach</span>&gt;</span></span><br><span class="line">								<span class="tag">&lt;/<span class="name">tbody</span>&gt;</span></span><br><span class="line">								<span class="tag">&lt;<span class="name">tfoot</span>&gt;</span></span><br><span class="line">									<span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">										<span class="tag">&lt;<span class="name">td</span> <span class="attr">colspan</span>=<span class="string">"6"</span> <span class="attr">align</span>=<span class="string">"center"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">											<span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">"pagination"</span>&gt;</span></span><br><span class="line">												<span class="comment">&lt;!-- 即使点击分页连接也应该带上查询条件的值 --&gt;</span></span><br><span class="line">												<span class="comment">&lt;!-- 给分页超链接绑定单击事件； --&gt;</span></span><br><span class="line">												<span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"$&#123;ctp&#125;/permission/user/list?pn=1"</span>&gt;</span>首页<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">												<span class="comment">&lt;!-- 是否还有前一页 --&gt;</span></span><br><span class="line">												<span class="tag">&lt;<span class="name">c:if</span> <span class="attr">test</span>=<span class="string">"$&#123;users.hasPreviousPage&#125;"</span>&gt;</span></span><br><span class="line">													<span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span></span></span><br><span class="line"><span class="tag">														<span class="attr">href</span>=<span class="string">"$&#123;ctp&#125;/permission/user/list?pn=$&#123;users.prePage&#125;"</span>&gt;</span>上一页<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">												<span class="tag">&lt;/<span class="name">c:if</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">												<span class="comment">&lt;!-- 遍历页数 --&gt;</span></span><br><span class="line">												<span class="tag">&lt;<span class="name">c:forEach</span> <span class="attr">items</span>=<span class="string">"$&#123;users.navigatepageNums&#125;"</span> <span class="attr">var</span>=<span class="string">"pn"</span>&gt;</span></span><br><span class="line">													<span class="comment">&lt;!-- 当前页 --&gt;</span></span><br><span class="line">													<span class="tag">&lt;<span class="name">c:if</span> <span class="attr">test</span>=<span class="string">"$&#123;pn==users.pageNum &#125;"</span>&gt;</span></span><br><span class="line">														<span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"active"</span>&gt;</span><span class="tag">&lt;<span class="name">a</span></span></span><br><span class="line"><span class="tag">															<span class="attr">href</span>=<span class="string">"$&#123;ctp&#125;/permission/user/list?pn=$&#123;pn&#125;"</span>&gt;</span>$&#123;pn&#125;<span class="tag">&lt;<span class="name">span</span></span></span><br><span class="line"><span class="tag">																<span class="attr">class</span>=<span class="string">"sr-only"</span>&gt;</span>(current)<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">													<span class="tag">&lt;/<span class="name">c:if</span>&gt;</span></span><br><span class="line">													<span class="tag">&lt;<span class="name">c:if</span> <span class="attr">test</span>=<span class="string">"$&#123;pn != users.pageNum &#125;"</span>&gt;</span></span><br><span class="line">														<span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"$&#123;ctp&#125;/permission/user/list?pn=$&#123;pn&#125;"</span>&gt;</span>$&#123;pn &#125;<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">													<span class="tag">&lt;/<span class="name">c:if</span>&gt;</span></span><br><span class="line">												<span class="tag">&lt;/<span class="name">c:forEach</span>&gt;</span></span><br><span class="line">												<span class="comment">&lt;!--是否还有下一页  --&gt;</span></span><br><span class="line">												<span class="tag">&lt;<span class="name">c:if</span> <span class="attr">test</span>=<span class="string">"$&#123;users.hasNextPage&#125;"</span>&gt;</span></span><br><span class="line">													<span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span></span></span><br><span class="line"><span class="tag">														<span class="attr">href</span>=<span class="string">"$&#123;ctp&#125;/permission/user/list?pn=$&#123;users.nextPage&#125;"</span>&gt;</span>下一页<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">												<span class="tag">&lt;/<span class="name">c:if</span>&gt;</span></span><br><span class="line">												<span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span></span></span><br><span class="line"><span class="tag">													<span class="attr">href</span>=<span class="string">"$&#123;ctp&#125;/permission/user/list?pn=$&#123;users.pages&#125;"</span>&gt;</span>末页<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">											<span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">										<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">									<span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line"></span><br><span class="line">								<span class="tag">&lt;/<span class="name">tfoot</span>&gt;</span></span><br><span class="line">							<span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line">						<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">					<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="tag">&lt;<span class="name">%@include</span> <span class="attr">file</span>=<span class="string">"/WEB-INF/includes/js-file.jsp"</span>%&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- 引入树形菜单结构点击时动态显示页面高亮效果的js --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">%@include</span> <span class="attr">file</span>=<span class="string">"/WEB-INF/includes/common-js.jsp"</span>%&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript">		$(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">			$(<span class="string">".list-group-item"</span>).click(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">				<span class="keyword">if</span> ($(<span class="keyword">this</span>).find(<span class="string">"ul"</span>)) &#123;</span></span><br><span class="line"><span class="javascript">					$(<span class="keyword">this</span>).toggleClass(<span class="string">"tree-closed"</span>);</span></span><br><span class="line"><span class="javascript">					<span class="keyword">if</span> ($(<span class="keyword">this</span>).hasClass(<span class="string">"tree-closed"</span>)) &#123;</span></span><br><span class="line"><span class="javascript">						$(<span class="string">"ul"</span>, <span class="keyword">this</span>).hide(<span class="string">"fast"</span>);</span></span><br><span class="line"><span class="javascript">					&#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="javascript">						$(<span class="string">"ul"</span>, <span class="keyword">this</span>).show(<span class="string">"fast"</span>);</span></span><br><span class="line"><span class="undefined">					&#125;</span></span><br><span class="line"><span class="undefined">				&#125;</span></span><br><span class="line"><span class="undefined">			&#125;);</span></span><br><span class="line"><span class="undefined">		&#125;);</span></span><br><span class="line"><span class="javascript">		$(<span class="string">"tbody .btn-success"</span>).click(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">			<span class="built_in">window</span>.location.href = <span class="string">"assignRole.html"</span>;</span></span><br><span class="line"><span class="undefined">		&#125;);</span></span><br><span class="line"><span class="javascript">		$(<span class="string">"tbody .btn-primary"</span>).click(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">			<span class="built_in">window</span>.location.href = <span class="string">"edit.html"</span>;</span></span><br><span class="line"><span class="undefined">		&#125;);</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">		<span class="comment">//当前页面所在的哪个超链接是color:red</span></span></span><br><span class="line"><span class="javascript">		<span class="comment">//他的父list-group-item.  tree-closed是没有的</span></span></span><br><span class="line"><span class="javascript">		<span class="comment">//找到当前页面的a连接</span></span></span><br><span class="line"><span class="javascript">		<span class="comment">//使用css为某个元素加样式  list-group-item</span></span></span><br><span class="line"><span class="javascript">		<span class="comment">//为所有分页连接绑定单击事件，让其动态的带上分页的查询参数</span></span></span><br><span class="line"><span class="javascript">		$(<span class="string">".pagination"</span>).find(<span class="string">"a"</span>).click(</span></span><br><span class="line"><span class="javascript">				<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">					<span class="comment">//1、获取到查询表单的查询参数</span></span></span><br><span class="line"><span class="javascript">					<span class="comment">//不禁用默认行为，而是为超链接多拼装上查询条件</span></span></span><br><span class="line"><span class="javascript">					<span class="comment">//为超链接动态拼装查询条件</span></span></span><br><span class="line"><span class="javascript">					<span class="keyword">var</span> href = $(<span class="keyword">this</span>).attr(<span class="string">"href"</span>) + <span class="string">"&amp;sp="</span></span></span><br><span class="line"><span class="javascript">							+ $(<span class="string">"input[name='sp']"</span>).val()</span></span><br><span class="line"><span class="javascript">					$(<span class="keyword">this</span>).attr(<span class="string">"href"</span>, href)</span></span><br><span class="line"><span class="undefined">				&#125;)</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">		<span class="comment">//这是调用了抽取过来的方法；</span></span></span><br><span class="line"><span class="javascript">		checkall_reverse($(<span class="string">"#checkall_btn"</span>), $(<span class="string">".single_check"</span>))</span></span><br><span class="line"><span class="undefined">	</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://shenlibing.github.io/myhexo/myhexo/2019/01/09/svn版本控制/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="shenlibing">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/myhexo/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="小兵兵">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/myhexo/2019/01/09/svn版本控制/" class="post-title-link" itemprop="url">svn版本控制</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2019-01-09 12:58:55" itemprop="dateCreated datePublished" datetime="2019-01-09T12:58:55+08:00">2019-01-09</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-01-22 17:13:43" itemprop="dateModified" datetime="2019-01-22T17:13:43+08:00">2019-01-22</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/myhexo/categories/日常记录/" itemprop="url" rel="index"><span itemprop="name">日常记录</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          
            <span id="/myhexo/2019/01/09/svn版本控制/" class="leancloud_visitors" data-flag-title="svn版本控制">
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              
                <span class="post-meta-item-text">阅读次数：</span>
              
                <span class="leancloud-visitors-count"></span>
            </span>
          

          

          
            <div class="post-symbolscount">
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">本文字数：</span>
                
                <span title="本文字数">1.2k</span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">1 分钟</span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>1、svn下载</p>
<p><a href="https://sourceforge.net/projects/win32svn/" target="_blank" rel="noopener">https://sourceforge.net/projects/win32svn/</a></p>
<p>2、验证是否安装成功</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">C:\Users\libingshen&gt;svn --version</span><br></pre></td></tr></table></figure>
<p>3、创建版本库</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">D:\mytest\mysvn\OA&gt;svnadmin create D:\mytest\mysvn\OA</span><br></pre></td></tr></table></figure>
<p><img src="https://i.imgur.com/v4aUp1n.png" alt=""></p>
<p>4、启动svn服务</p>
<p><img src="https://i.imgur.com/CStIBx9.png" alt=""></p>
<p>5、验证svn服务是否启动</p>
<p>svn服务监听3690端口</p>
<p><img src="https://i.imgur.com/sogDN9t.png" alt=""></p>
<p>6、svn注册为Windows服务</p>
<p>tip:等号左边没有空格，等号右边有一个空格。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">C:\WINDOWS\system32&gt;sc create MySVNService binpath= &quot;C:\Pmyprogram\svn\bin\svnserve.exe --service -r D:\mytest\mysvn&quot; start= auto depend= Tcpip</span><br></pre></td></tr></table></figure>
<p>原因：每次启动svn服务时必须启动一个cmd窗口，cmd窗口一关闭，svn服务就关闭。</p>
<p>非管理员运行时会失败。<br><img src="https://i.imgur.com/rPliKES.png" alt=""></p>
<p>管理员运行<br><img src="https://i.imgur.com/gBmdKhJ.png" alt=""></p>
<p><img src="https://i.imgur.com/whIFJo4.png" alt=""></p>
<p>启动、停止、删除svn服务（管理员身份运行cmd）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">//启动svn服务</span><br><span class="line">C:\WINDOWS\system32&gt;sc start MySVNService</span><br><span class="line"></span><br><span class="line">//停止服务</span><br><span class="line">C:\WINDOWS\system32&gt;sc stop MySVNService</span><br><span class="line"></span><br><span class="line">//删除服务</span><br><span class="line">C:\WINDOWS\system32&gt;sc delete MySVNService</span><br></pre></td></tr></table></figure>
<p>7、检出项目</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">D:\mytest\mycheckout&gt;svn checkout svn://localhost/OA MyOA</span><br></pre></td></tr></table></figure>
<p><img src="https://i.imgur.com/vvRuF4T.png" alt=""></p>
<p>8、提交文件</p>
<p>–开启匿名权限访问</p>
<p><img src="https://i.imgur.com/hBW5DuW.png" alt=""></p>
<p>–先将文件加入版本库，然后提交（需添加提交日志信息，不然报错）</p>
<p>svn commit 命令最后可以不指定具体文件，此时表示提交当前工作副本中<br>的所有修改</p>
<p><img src="https://i.imgur.com/r1IpUsZ.png" alt=""></p>
<p>9、更新</p>
<p>另一个客户端检出项目、更新并提交文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">//远程版本库具体位置  svn://localhost/OA</span><br><span class="line">//将OA检出到本地的目录 MyOA2</span><br><span class="line">D:\mytest\mycheckout&gt;svn checkout svn://localhost/OA MyOA2</span><br></pre></td></tr></table></figure>
<p><img src="https://i.imgur.com/u4zFEcf.png" alt=""></p>
<p><img src="https://i.imgur.com/67qMr6A.png" alt=""></p>
<p>10、授权访问版本库</p>
<p>–单版本库开启授权访问</p>
<p><img src="https://i.imgur.com/emwZBDY.png" alt=""></p>
<p>–多版本库开启授权访问</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">在版本库根目录 D:\mytest\mysvn 下创建 commConf 目录</span><br><span class="line">将未修改的 authz 和 passwd 文件拷贝到 commConf 目录下</span><br><span class="line">修改需要设置权限的版本库的 svnserve.conf 文件</span><br><span class="line">①password-db = ../../commConf/passwd</span><br><span class="line">②authz-db = ../../commConf/authz</span><br></pre></td></tr></table></figure>
<p><img src="https://i.imgur.com/QjqreHq.png" alt=""></p>
<p>passwd：设置访问版本库的用户信息</p>
<p><img src="https://i.imgur.com/7TQZlnl.png" alt=""></p>
<p>authz：设置用户访问版本库的权限</p>
<p><img src="https://i.imgur.com/XIZ9z9v.png" alt=""></p>
<hr>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/myhexo/page/2/">2</a><a class="extend next" rel="next" href="/myhexo/page/2/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <div class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">shenlibing</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/myhexo/archives/">
                
                    <span class="site-state-item-count">17</span>
                    <span class="site-state-item-name">日志</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  <a href="/myhexo/categories/index.html">
                    
                    
                      
                    
                    <span class="site-state-item-count">1</span>
                    <span class="site-state-item-name">分类</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  <a href="/myhexo/tags/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">15</span>
                    <span class="site-state-item-name">标签</span>
                  </a>
                </div>
              
            </nav>
          

          

          

          

          
          

          
            
          
          

        </div>
      </div>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">shenlibing</span>

  
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-area-chart"></i>
    </span>
    
    <span title="站点总字数">119k</span>
  

  
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    
    <span title="站点阅读时长">1:48</span>
  
</div>


  <div class="powered-by">由 <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> 强力驱动 v3.8.0</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 – <a href="https://theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a> v6.7.0</div>







 <div>友情链接：
  <a class="theme-link" href="http://collect.w3ctrain.com/"> 前端收藏夹 </a><span>&nbsp;&nbsp;</span>
  <a class="theme-link" href="http://www.alloyteam.com/nav/"> Web前端导航 </a><span>&nbsp;&nbsp;</span>
  <a class="theme-link" href="http://www.runoob.com/"> 菜鸟教程 </a><span>&nbsp;&nbsp;</span>
  <a class="theme-link" href="https://mccxj.github.io/"> 小毛的胡思乱想 </a><span>&nbsp;&nbsp;</span>
 </div>

        








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

    

    
  </div>

  

<script>
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>














  
    
    
  
  <script color="0,0,255" opacity="0.5" zindex="-1" count="99" src="/myhexo/lib/canvas-nest/canvas-nest.min.js"></script>













  
  <script src="/myhexo/lib/jquery/index.js?v=2.1.3"></script>

  
  <script src="/myhexo/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script src="/myhexo/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>


  


  <script src="/myhexo/js/src/utils.js?v=6.7.0"></script>

  <script src="/myhexo/js/src/motion.js?v=6.7.0"></script>



  
  


  <script src="/myhexo/js/src/affix.js?v=6.7.0"></script>

  <script src="/myhexo/js/src/schemes/pisces.js?v=6.7.0"></script>



  

  


  <script src="/myhexo/js/src/bootstrap.js?v=6.7.0"></script>



  



  

  <script>
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/myhexo/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url).replace(/\/{2,}/g, '/');
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x"></i></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x"></i></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  
  
  <script>
    
    function showTime(Counter) {
      var entries = [];
      var $visitors = $('.leancloud_visitors');

      $visitors.each(function() {
        entries.push( $(this).attr('id').trim() );
      });

      Counter('get', '/classes/Counter', { where: JSON.stringify({ url: { '$in': entries } }) })
        .done(function({ results }) {
          var COUNT_CONTAINER_REF = '.leancloud-visitors-count';

          if (results.length === 0) {
            $visitors.find(COUNT_CONTAINER_REF).text(0);
            return;
          }

          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.url;
            var time = item.time;
            var element = document.getElementById(url);

            $(element).find(COUNT_CONTAINER_REF).text(time);
          }
          for (var i = 0; i < entries.length; i++) {
            var url = entries[i];
            var element = document.getElementById(url);
            var countSpan = $(element).find(COUNT_CONTAINER_REF);
            if (countSpan.text() == '') {
              countSpan.text(0);
            }
          }
        })
        .fail(function ({ responseJSON }) {
          console.log(`LeanCloud Counter Error: ${responseJSON.code} ${responseJSON.error}`);
        });
    }
    

    $(function() {
      $.get('https://app-router.leancloud.cn/2/route?appId=' + 'BedsOkBLOBR4nM4W52xTcBhb-gzGzoHsz')
        .done(function({ api_server }) {
          var Counter = function(method, url, data) {
            return $.ajax({
              method: method,
              url: 'https://' + api_server + '/1.1' + url,
              headers: {
                'X-LC-Id': 'BedsOkBLOBR4nM4W52xTcBhb-gzGzoHsz',
                'X-LC-Key': 'EEaRfb6dCMaS38laDCkSYhM9',
                'Content-Type': 'application/json',
              },
              data: data
            });
          };
          
            if ($('.post-title-link').length >= 1) {
              showTime(Counter);
            }
          
        });
    });
  </script>



  

  

  

  

  

  

  

  

  

  

  

  


  <script type="text/javascript" src="//cdn.bootcss.com/canvas-nest.js/1.0.0/canvas-nest.min.js"></script>

</body>
</html>
